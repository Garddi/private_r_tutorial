<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gard Olav Dietrichson">

<title>R Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-r" id="toc-what-is-r" class="nav-link" data-scroll-target="#what-is-r"><span class="header-section-number">1.1</span> What is R?</a></li>
  <li><a href="#who-uses-r-and-why" id="toc-who-uses-r-and-why" class="nav-link" data-scroll-target="#who-uses-r-and-why"><span class="header-section-number">1.2</span> Who uses R, and why?</a></li>
  <li><a href="#installing-r" id="toc-installing-r" class="nav-link" data-scroll-target="#installing-r"><span class="header-section-number">1.3</span> Installing R</a></li>
  <li><a href="#code-editor-rstudio-if-we-are-being-honest" id="toc-code-editor-rstudio-if-we-are-being-honest" class="nav-link" data-scroll-target="#code-editor-rstudio-if-we-are-being-honest"><span class="header-section-number">1.4</span> Code Editor (Rstudio, if we are being honest)</a></li>
  </ul></li>
  <li><a href="#general-structure" id="toc-general-structure" class="nav-link" data-scroll-target="#general-structure"><span class="header-section-number">2</span> General structure</a>
  <ul class="collapse">
  <li><a href="#data-types" id="toc-data-types" class="nav-link" data-scroll-target="#data-types"><span class="header-section-number">2.1</span> Data Types</a></li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment"><span class="header-section-number">2.2</span> Assignment</a>
  <ul class="collapse">
  <li><a href="#other-operators" id="toc-other-operators" class="nav-link" data-scroll-target="#other-operators"><span class="header-section-number">2.2.1</span> Other operators</a></li>
  </ul></li>
  <li><a href="#vectors" id="toc-vectors" class="nav-link" data-scroll-target="#vectors"><span class="header-section-number">2.3</span> Vectors</a></li>
  <li><a href="#dataframes" id="toc-dataframes" class="nav-link" data-scroll-target="#dataframes"><span class="header-section-number">2.4</span> Dataframes</a></li>
  <li><a href="#lists" id="toc-lists" class="nav-link" data-scroll-target="#lists"><span class="header-section-number">2.5</span> Lists</a></li>
  <li><a href="#unique-object-types" id="toc-unique-object-types" class="nav-link" data-scroll-target="#unique-object-types"><span class="header-section-number">2.6</span> Unique Object Types</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">2.7</span> Functions</a></li>
  <li><a href="#folder-structure-and-saving-results" id="toc-folder-structure-and-saving-results" class="nav-link" data-scroll-target="#folder-structure-and-saving-results"><span class="header-section-number">2.8</span> Folder structure and saving results</a></li>
  <li><a href="#added-notes-on-indexing" id="toc-added-notes-on-indexing" class="nav-link" data-scroll-target="#added-notes-on-indexing"><span class="header-section-number">2.9</span> Added Notes on Indexing</a></li>
  </ul></li>
  <li><a href="#simple-analysis" id="toc-simple-analysis" class="nav-link" data-scroll-target="#simple-analysis"><span class="header-section-number">3</span> Simple Analysis</a>
  <ul class="collapse">
  <li><a href="#simple-data-structure-functions" id="toc-simple-data-structure-functions" class="nav-link" data-scroll-target="#simple-data-structure-functions"><span class="header-section-number">3.1</span> Simple data structure functions</a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">4</span> Data wrangling</a>
  <ul class="collapse">
  <li><a href="#dealing-with-bad-names" id="toc-dealing-with-bad-names" class="nav-link" data-scroll-target="#dealing-with-bad-names"><span class="header-section-number">4.1</span> Dealing with bad names</a></li>
  <li><a href="#mutating" id="toc-mutating" class="nav-link" data-scroll-target="#mutating"><span class="header-section-number">4.2</span> Mutating</a>
  <ul class="collapse">
  <li><a href="#ifelse-and-case-when-mutations" id="toc-ifelse-and-case-when-mutations" class="nav-link" data-scroll-target="#ifelse-and-case-when-mutations"><span class="header-section-number">4.2.1</span> Ifelse and Case when mutations</a></li>
  <li><a href="#across" id="toc-across" class="nav-link" data-scroll-target="#across"><span class="header-section-number">4.2.2</span> Across</a></li>
  <li><a href="#new-variables-as-vectors" id="toc-new-variables-as-vectors" class="nav-link" data-scroll-target="#new-variables-as-vectors"><span class="header-section-number">4.2.3</span> New variables as vectors</a></li>
  </ul></li>
  <li><a href="#subsetting-on-variables" id="toc-subsetting-on-variables" class="nav-link" data-scroll-target="#subsetting-on-variables"><span class="header-section-number">4.3</span> Subsetting on variables</a></li>
  <li><a href="#filtering" id="toc-filtering" class="nav-link" data-scroll-target="#filtering"><span class="header-section-number">4.4</span> Filtering</a></li>
  <li><a href="#grouping-and-aggregating" id="toc-grouping-and-aggregating" class="nav-link" data-scroll-target="#grouping-and-aggregating"><span class="header-section-number">4.5</span> Grouping and Aggregating</a></li>
  <li><a href="#joining" id="toc-joining" class="nav-link" data-scroll-target="#joining"><span class="header-section-number">4.6</span> Joining</a></li>
  <li><a href="#pivoting" id="toc-pivoting" class="nav-link" data-scroll-target="#pivoting"><span class="header-section-number">4.7</span> Pivoting</a></li>
  </ul></li>
  <li><a href="#modelling" id="toc-modelling" class="nav-link" data-scroll-target="#modelling"><span class="header-section-number">5</span> Modelling</a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting"><span class="header-section-number">6</span> Plotting</a>
  <ul class="collapse">
  <li><a href="#layers" id="toc-layers" class="nav-link" data-scroll-target="#layers"><span class="header-section-number">6.1</span> Layers</a></li>
  <li><a href="#maps" id="toc-maps" class="nav-link" data-scroll-target="#maps"><span class="header-section-number">6.2</span> Maps</a></li>
  </ul></li>
  <li><a href="#advanced-methods" id="toc-advanced-methods" class="nav-link" data-scroll-target="#advanced-methods"><span class="header-section-number">7</span> Advanced methods</a>
  <ul class="collapse">
  <li><a href="#for-loops-and-flow-control" id="toc-for-loops-and-flow-control" class="nav-link" data-scroll-target="#for-loops-and-flow-control"><span class="header-section-number">7.1</span> For loops and flow control</a>
  <ul class="collapse">
  <li><a href="#flow-control" id="toc-flow-control" class="nav-link" data-scroll-target="#flow-control"><span class="header-section-number">7.1.1</span> flow control</a></li>
  </ul></li>
  <li><a href="#functional-programming-with-anonymous-functions" id="toc-functional-programming-with-anonymous-functions" class="nav-link" data-scroll-target="#functional-programming-with-anonymous-functions"><span class="header-section-number">7.2</span> Functional programming with anonymous functions</a>
  <ul class="collapse">
  <li><a href="#a-very-complicated-for-loop" id="toc-a-very-complicated-for-loop" class="nav-link" data-scroll-target="#a-very-complicated-for-loop"><span class="header-section-number">7.2.1</span> A very complicated for loop</a></li>
  </ul></li>
  <li><a href="#string-manipulation" id="toc-string-manipulation" class="nav-link" data-scroll-target="#string-manipulation"><span class="header-section-number">7.3</span> String manipulation</a></li>
  <li><a href="#keyboard-shortcuts-and-tips" id="toc-keyboard-shortcuts-and-tips" class="nav-link" data-scroll-target="#keyboard-shortcuts-and-tips"><span class="header-section-number">7.4</span> Keyboard shortcuts and tips</a></li>
  <li><a href="#structuring-your-scripts" id="toc-structuring-your-scripts" class="nav-link" data-scroll-target="#structuring-your-scripts"><span class="header-section-number">7.5</span> Structuring your scripts</a></li>
  <li><a href="#quarto---creating-nice-documents-in-rstudio-with-code" id="toc-quarto---creating-nice-documents-in-rstudio-with-code" class="nav-link" data-scroll-target="#quarto---creating-nice-documents-in-rstudio-with-code"><span class="header-section-number">7.6</span> Quarto - creating nice documents in RStudio with code</a></li>
  <li><a href="#special-environment-section" id="toc-special-environment-section" class="nav-link" data-scroll-target="#special-environment-section"><span class="header-section-number">7.7</span> Special Environment section</a></li>
  </ul></li>
  <li><a href="#recommended-packages-and-ecosystems-to-explore" id="toc-recommended-packages-and-ecosystems-to-explore" class="nav-link" data-scroll-target="#recommended-packages-and-ecosystems-to-explore"><span class="header-section-number">8</span> Recommended packages and ecosystems to explore!</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R Tutorial</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gard Olav Dietrichson </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome to a (more or less) thorough walkthrough of R in applied areas. Covers the sections: General Structure, Data import, Simple Data checking, Data Wrangling, Plotting, and advanced R methods. If you want to read it in darkmode there is a button-thing in the top right corner (multi-language support is coming… maybe).</p>
<p>When it comes to utilizing this document, I want to emphasize the fact that the document is intended to give you the tools to independently solve problems, and to troubleshoot potential problems. While generative AI is currently doing quite well in helping amateur coders like us be proficient in programming for social data science, using such services often depend on you understanding the nature of the problem. For that reason, familiarity with the basic construction of the language, enables you to do troubleshooting to figure out where your code has gone wrong in the first place. I also believe that having familiarity with the language, allows you to understand any suggested code that may be thrown at you by a generative AI model better, and you will be better at utilizing this to expand your own knowledge.</p>
<p>Before we dive deeper into explaining the elements of R as a programming language, we can start by having a brief discussion about what R <em>is</em> and how you as a student/data scientist/whatever you are will interact with this programming language. The remaining text will be narrowly focused on code <em>as is</em>, but in this section, I would like to talk a bit about how you will experience using the software.</p>
<section id="what-is-r" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="what-is-r"><span class="header-section-number">1.1</span> What is R?</h2>
<p>R is a programming language dedicated to statistical analysis. A simple review of the wikipedia page for programming languages by type, tells us that R is an array, interpreted, impure, interactive mode, list-based, object-oriented prototype-based, and scripting language. As it is a programming language, there are few things that you cannot do through R with your computer. Later on, when we are writing code itself, you will see that programming involves managing elements in your memory (objects or functions) and interacting them with eachother to produce an output from your code. The code itself is written in plain text, and can technically be written with something as simple as a notepad, but using a dedicated environment will allow many advantages, such as typing completion, dedicated graph viewer windows, and a window for all the objects in your environment (but this is getting ahead of ourselves).</p>
<p>In the definition of R as a programming language, I mentioned that it is interactive. This means that you are able to execute parts of the code in whatever sequence you want, and you are able to individually send certain lines of code to the REPL (the console as we will call it), and get the results of that code immediately. This is different from certain other programming languages, which require you to run the entire code each time you wish to see elements of it.</p>
</section>
<section id="who-uses-r-and-why" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="who-uses-r-and-why"><span class="header-section-number">1.2</span> Who uses R, and why?</h2>
<p>R is one of two primary programming languages used by professional data scientists, alongside Python (and to a lesser extent Julia, but we are not <strong>that</strong> concerned with computational time). Whereas Python has advantages over R in terms of applied computational time, and integration with certain machine learning models, R is by most considered to be easier to learn, as well as having more reliable and accessible tools for data-wrangling, plotting, and statistical modelling (it also doesn’t use significant whitespace, which is the devil’s work). Additionally, there is a rich eco-system of well-integrated package libraries that allow for new tools to be added to your R environment. In this tutorial for instance, we will utilize the <code>tidyverse</code> family of packages, which provide a long list of helpful functions that all work well with each other. R also has integration with advanced statistical models such as structural topic models through <code>stm</code>, and Bayesian data analysis through <code>rstan</code>.</p>
<p>As previously mentioned, R is a programming language, and can therefore do almost everything you could want from a computer (as long as you can code it). In my own experience from knowledge of working life, both Statistics Norway, and the office of the auditor general (Riksrevisjonen) in Norway, primarily rely on R for their work. Additionally, I know of a couple of credit analysis firms that do contract work for banks, that utilize R primarily. The program is used heavily in statistical analysis across sectors, is my main point here.</p>
</section>
<section id="installing-r" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="installing-r"><span class="header-section-number">1.3</span> Installing R</h2>
<p>The first thing you need to do when starting to program in R, is to download R itself. Currently, the latest version of R is 4.4.1 (August 10th, 2024), and you can get a version by retrieving it from a distributor from a CRAN mirror here: https://cran.r-project.org/mirrors.html I select the version from Norway, and just follow the link for “download R for windows”. R is totally free and open source, and you do not need a license or anything of the sort to use it.</p>
</section>
<section id="code-editor-rstudio-if-we-are-being-honest" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="code-editor-rstudio-if-we-are-being-honest"><span class="header-section-number">1.4</span> Code Editor (Rstudio, if we are being honest)</h2>
<p>Once you have R on your computer, you will need a way to edit scripts so that you can work with the language more easily. In programming this is usually done through an Integrated Developer Environment (IDE), a program which has dedicated elements that allow you to write code better. For R, the preferred IDE is RStudio, which is run by Posit, a foundation that is responsible for many of the quality of life extension to the R language that has come about in the past decade, such as the tidyverse ecosystem. You can download RStudio from posit’s homepage at: https://posit.co/download/rstudio-desktop/.</p>
<p>When you open RStudio, it might at first seem a bit overwhelming, so let’s take the time to explain what the layout of RStudio is like, and how you can use elements of it to your benefit. When opening RStudio for the first time, it will look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/rstudio_default.png" class="img-fluid figure-img"></p>
<figcaption>Default Rstudio appearance</figcaption>
</figure>
</div>
<p>If you are uncomfortable with a light editor, you can also change to dark mode by opening the tools header on the top of your editor, then clicking global options, then find the appearance tab to select a new theme for RStudio. In the image, we see three essential windows currently open, normally you will have four of these windows, but we will get to the script window later. The first window we will discuss is the console window, in the image it takes up half the screen. This is where the direct output of many of your functions will be printed, the console is the actual interpreter of all code that you feed into it, and by default it will print out the results of such code. You can also type in code directly into that console, try typing in 1 + 1 in your own console if you are following along. When we write scripts and execute sections of the script, what we are actually doing is sending the code we write to the console. A script is just a way of saving the information for future use and replication.</p>
<p>On your right then, we will see there are two windows. The top window, is by default your environment, you will primarily use this window to keep track of objects in your environment, such as datasets, functions, lists, etc. The environment does also have extensions for browsing functions imported by other packages, but for the most basic of usecases, you will only need to have the global environment displayed in this window. You may also notice there are several other panes in this window, such as history and connections, these will most likely not be relevant for you. In the window below this, you will find the window for files, plots, packages, help and viewer. This window you will more likely change between different panes. Files provide you with easy access to your files, and is basicly another file explorer, that you can also load datasets through, and otherwise more easily interact with elements of your project with. The plots pane will be where your plots appear when you start to make them, through it you can also save such plots, if you prefer doing it that way, rather than through code. The packages pane will be where you can check what packages you have installed, what versions they are, and update them if they are out of date. The help pane will be where the documentation for functions will appear, so that you can read about how to use certain functions. The viewer pane is for certain html elements that will be produced by some code outputs, such as the <code>modelsummary</code> package for making regression tables.</p>
<p>The final window that should be in your RStudio is that for your script editing itself. To open up a new script, note the small icon of a paper sheet with a pluss sign attached to it, below the “file” and “edit” pane in the top left of your editor. Click this, and select R-script, or alternatively just press ctrl+shift+n, to create a new script. This will open an empty text file, in which you can start typing out your R-script. When you type out a line in an R-script, you will notice that the IDE will autocomplete the text you are writing, if there is an existing object or a function that follows. When you write anything in a script, you can place your cursor on the line that you are working with, or highlight what you want to run, and press ctrl+enter to send that line of code to the console, and execute it. Try typing 1+1 in your script window, then sending it to the console for execution.</p>
</section>
</section>
<section id="general-structure" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> General structure</h1>
<section id="data-types" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-types"><span class="header-section-number">2.1</span> Data Types</h2>
<p>Information takes several forms in R, all attached with a class, the basic forms of data that needs to be known are numeric (will appear as “double” sometimes, this is related to memory allocation, but just means more decimals numeric), integer (whole numbers), complex (complex numbers, such as <code>2i</code>), factor (text but with numbers assigned to certain values, this is created using a function), character, boolean (logical, true or false), and several types of Date data. Additionally there are a class of missing values, but they are all covered by NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="do">### Comments are in hashtags </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="st">"hello"</span> <span class="do">## Strings or characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>i <span class="do">## Complex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0+2i</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## NA can also have type specific values, but these are *never* used</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cn">NA_character_</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cn">NA_complex_</span> <span class="do">## All yield same output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Boolean datas</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>All entries in a script (which is just a text file), are sent to the console which interprets the text. There are also certain special datatypes, such as NULL for empty (which is not the same as missing), Inf for infinite values (dividing by zero for instance), and NaN (Not a Number, errors in certain computational processes)</p>
</section>
<section id="assignment" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="assignment"><span class="header-section-number">2.2</span> Assignment</h2>
<p>While strictly speaking a functional programming language, object oriented programming is highly supported, and the norm for usage amongst data scientists. Most outputs in the language will be assigned a name, and appear in the global environment (in one of the other windows in your RStudio IDE). This is done either with a <code>=</code> or (more commonly, due to specific interactions with an equals sign) with the <code>&lt;-</code> known as the assignment operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hello <span class="ot">&lt;-</span> <span class="dv">23</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>hello <span class="do">## Calling the object prints the content by default</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23</code></pre>
</div>
</div>
<p>There also exists a <code>&lt;&lt;-</code> assignment operator, which can assign objects on a global scope within function environments, but this word salad is too advanced for this simple tutorial.</p>
<section id="other-operators" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="other-operators"><span class="header-section-number">2.2.1</span> Other operators</h3>
<p>Other operators become important when discussing logical tests or other mathematical operations.</p>
<ul>
<li>+, -, /, *, ^ all does what you would expect</li>
<li>== Strict logical test, is this equal to the other thing, response in boolean</li>
<li>!= Strict anti-logical test, is this thing different to the other thing, response in boolean</li>
<li>&lt;, &gt;, &lt;=, &gt;=, less than, larger than, less or equal than, larger or equal than, logical tests, returns boolean</li>
<li>&amp;, |, Binding operators for more logical tests &amp; (AND operator) requires both elements to be true, while | (OR operator) requires only one to be true</li>
<li>%in% Contained logical test, is there a unit in this other element which is strictly equal to the first thing.</li>
<li>! in general reverses the proceeding logical test, so if you write <code>!("YES" == "YES")</code> it will ask if the thing inside the parenthesis <em>is not</em> the case, reversing the logical test.</li>
<li>:, integer operator, creates a vector of elements between the starting points. <code>1:7</code> will create a vector of whole numbers from 1 to and including 7</li>
<li><code>%%</code>, modulus operator, divides number preceeding it by number following it, and returns the remainder, so <code>12 %% 5</code> will return 2, since 5*2 = 10, with 2 as the remainder.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Yes"</span> <span class="sc">==</span> <span class="st">"Yes"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Yes"</span> <span class="sc">==</span> <span class="st">"No"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Yes"</span> <span class="sc">!=</span> <span class="st">"Yes"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Yes"</span> <span class="sc">!=</span> <span class="st">"No"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Yes"</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"no"</span>, <span class="st">"Maybe"</span>, <span class="st">"Yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">### R is also what is called "loosely" typed, so this works</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">==</span> <span class="st">"3"</span> <span class="do">## Equal even tho they are different types of data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Logical tests are also relevant through certain functions, these functions all return either TRUE or FALSE values, which is useful in several cases, inside other functions or for flow control in loops (all of this is covered later). These functions include <code>is.na</code>, <code>is.empty</code>, <code>is.character</code>, <code>is.numeric</code>, etc. Lots of functions to explore that start with <code>is.</code></p>
</section>
</section>
<section id="vectors" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="vectors"><span class="header-section-number">2.3</span> Vectors</h2>
<p>All complex data of interest to us in R is either a vector, a list or a dataframe (Matrix and Arrays exist, but are not relevant to this scope). Vectors are uni-dimensional with strict same type requirement, dataframes are two-dimensional, and lists are uni-dimensionals with no requirement for consistency among entries. Vectors are created manually using the <code>c</code> function, as seen below, which simply creates an object of type vector, containing the elements within the parenthesis. Some functions will also output vectors, which can then be assigned to variables, or to standalone vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>a_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All dimensional datatypes can be indexed using brackets, to call individual elements of the object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>a_vector[<span class="dv">4</span>] <span class="do">## Fourth number of the vector above</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</section>
<section id="dataframes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="dataframes"><span class="header-section-number">2.4</span> Dataframes</h2>
<p>Two dimensional data structures are referred to as dataframes, and consists of rows of units across columns of variables. Columns are essentially vectors, and must therefore be of the same type, and have to be the same length for each entry. Indexing is done using brackets, and has to be separated with a comma, first number is the rownumber, second is the column number. Empty spaces extracts the whole row/column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_example <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">names =</span> <span class="fu">c</span>(<span class="st">"Gard"</span>, <span class="st">"Grad"</span>, <span class="st">"Gard Olav"</span>, <span class="st">"the Notorious G.A.R.D."</span>),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">27</span>, <span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">19</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fav_movie =</span> <span class="fu">c</span>(<span class="st">"The Adolescence of Utena"</span>, <span class="st">"12 Angry Men"</span>, <span class="st">"Inception"</span>, <span class="st">"Straight outta Compton"</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">happy =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>df_example[<span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  names age                fav_movie happy
1  Gard  27 The Adolescence of Utena FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_example[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  names age                fav_movie happy
1  Gard  27 The Adolescence of Utena FALSE
2  Grad  23             12 Angry Men  TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_example[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard"                   "Grad"                   "Gard Olav"             
[4] "the Notorious G.A.R.D."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_example[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   names age
1                   Gard  27
2                   Grad  23
3              Gard Olav  21
4 the Notorious G.A.R.D.  19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_example[<span class="dv">3</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Selecting on names</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>df_example[,<span class="fu">c</span>(<span class="st">"fav_movie"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Adolescence of Utena" "12 Angry Men"            
[3] "Inception"                "Straight outta Compton"  </code></pre>
</div>
</div>
<p>The most common process of accessing variables when using dataframe objects however, is to use the $ sign, which is an indexation tool for column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Index tool</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27 23 21 19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>happy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE FALSE  TRUE</code></pre>
</div>
</div>
</section>
<section id="lists" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="lists"><span class="header-section-number">2.5</span> Lists</h2>
<p>Lists can have anything in them, even dataframes, vectors, or even other lists, with no rules as to consistency over elements. Elements are then stored unidimensionally, accessed with double brackets for a relevant element. Named lists can also have names instead of just numbers attached to their entries, and can therefore be accessed with the names instead of a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ex_list <span class="ot">&lt;-</span> <span class="fu">list</span>(df_example, a_vector)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ex_list[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 5 6 7 1</code></pre>
</div>
</div>
<p>Lists are not often used in our branch of datascience, but will appear as accidental outputs to certain functions and processes, so its good to know what they are.</p>
</section>
<section id="unique-object-types" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="unique-object-types"><span class="header-section-number">2.6</span> Unique Object Types</h2>
<p>The previously mentioned structured data types represent the main “family” of object types in R. However, in the Object-Oriented paradigm, you often work with unique classes of objects as outputs from certain functions. These are usually the result of a package, and will often appear in your environment as something other than a list or a dataframe, but in the data portion of your environment. These classes have dedicated methods that control the ouput of certain functions when applied on them, but most of them are technically just named lists, and can be accessed in the same ways we did with lists above. Some are formal S4 class objects, which <em>can</em> technically be indexed using the <code>@</code> operator, but you are doing some strange stuff if that is necessary.</p>
</section>
<section id="functions" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="functions"><span class="header-section-number">2.7</span> Functions</h2>
<p>Functions are, the single most important aspect that exists in R, they are not commands, this ain’t stata. Understanding the universe of functions afforded to you through a multitude of packages is the key to conducting efficient data processing in R.</p>
<p>A function has the general form of <code>function_name(argument_1, argument_2, ... argument_n)</code>. All functions have clearly defined arguments, which control the outcome of the function. What these arguments are, are specified in the help file, which can be called upon by typing <code>?function</code> in the console. Sometimes these arguments are data oriented, the first argument in many tidyverse functions for instance, is a dataframe. Others are control oriented, meaning that they control specifications of the function itself. The function <code>mean()</code> for instance, takes three primary arguments, one is a vector of numbers (it also strictly only accepts dataypes that can be interpreted as numbers, so no character means), the second is a trim value, which is set to trim certain percentages of each side of the numerical distribution. Finally there is a na.rm argument, which controls whether or not to remove missing values before computing, if not done, a vector with missing values will return an error from the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(a_vector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.833333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(a_vector, <span class="at">trim =</span> .<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>new_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="cn">NA</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(new_vector)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(new_vector, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.166667</code></pre>
</div>
</div>
<p>Many functions are part of packages which needs to be installed to your computer using the <code>install.packages</code> function, and then when utilized needs to be loaded into the namespace you are currently operating in, using the reserved function <code>library</code>. Additionally, all functions (should at least) have a help file, which you can access by placing a <code>?</code> in front of the function, and then executing the empty function such as <code>?mean()</code>, although you don’t need the parenthesis. The help file will list the structure of the function, the necessary arguments, and their default values. Do note however, that these help files can be extremely confusing to read for anyone who does not already understand them.</p>
</section>
<section id="folder-structure-and-saving-results" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="folder-structure-and-saving-results"><span class="header-section-number">2.8</span> Folder structure and saving results</h2>
<p>If you want to save your resulting items, whether they be dataframes or images or tables, you need to have a good idea about what your folder structure looks like. Your console is usually set to be in a certain working directory. You can find this working directory, by using the <code>getwd</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Users/xdiega/OneDrive/Documents/advanced_statistics_phd/private_r_tutorial"</code></pre>
</div>
</div>
<p>From this working directory, you can access all files that are on your computer, if you know where they are relative to each other. Remember that all directories (or folders) are subfolders of other elements. To reach other files you navigate using / separators. So if I want to reach the files that are in a folder within my current working directory, I specify them with a / and then the subfolder. If I for instance want to know what files are in the images subfolder of my current working directory, I specify that as following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">"./images/"</span>) <span class="do">## ./ means the current working directory</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bad_stuff.png"         "gglayers.png"          "healy_vis.jpeg"       
[4] "heres_quarto.png"      "outliners.png"         "rstudio_default.png"  
[7] "yaml_example_word.png" "yaml_header.png"      </code></pre>
</div>
</div>
<p>However, you are not limited to only subfolders in your current directory, by using two dots, instead of one, you go to the parent folder of your directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">"../."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "09-STS313.pdf"                                                                                                                      
 [2] "advanced_statistics_phd.Rproj"                                                                                                      
 [3] "alice58budget.txt"                                                                                                                  
 [4] "brms_tests.R"                                                                                                                       
 [5] "causal_inference_doc.html"                                                                                                          
 [6] "causal_inference_doc.qmd"                                                                                                           
 [7] "data_provided"                                                                                                                      
 [8] "drafts_for_stina.R"                                                                                                                 
 [9] "exercise_drafts.R"                                                                                                                  
[10] "final_paper"                                                                                                                        
[11] "final_paper_draft_script.R"                                                                                                         
[12] "handout_scripts"                                                                                                                    
[13] "lecture_notes_USETHEM.txt"                                                                                                          
[14] "MethodologyintheSocialSciencesTimothyA.BrownPsyD-ConfirmatoryFactorAnalysisforAppliedResearchSecondEdition-TheGuilfordPress2015.pdf"
[15] "mlm_exercise.html"                                                                                                                  
[16] "mlm_exercise.qmd"                                                                                                                   
[17] "mlm_exercise_files"                                                                                                                 
[18] "my_bib.bib"                                                                                                                         
[19] "my_data"                                                                                                                            
[20] "PAGED-basic-party-dataset-with-party-codes-Dec-2023.csv"                                                                            
[21] "PAGED-Notes-on-coding-principles.pdf"                                                                                               
[22] "PAGED-WECEE-Party-dataset-with-party-codes-Dec-2023.csv"                                                                            
[23] "PAGED-WECEE-Party-dataset-with-party-codes-Dec-2023.xlsx"                                                                           
[24] "PAGED WE+CEE Potential coalition dataset with party codes (Dec 2023).csv"                                                           
[25] "parlgov_data"                                                                                                                       
[26] "PhD Papers.zip"                                                                                                                     
[27] "presentation"                                                                                                                       
[28] "private_r_tutorial"                                                                                                                 
[29] "some_data_prep.R"                                                                                                                   
[30] "some_exploration.R"                                                                                                                 
[31] "test_starlooking.html"                                                                                                              
[32] "v1-PAGED-basic-party-dataset-codebook.pdf"                                                                                          </code></pre>
</div>
</div>
<p>Note that the folder which we saw as my working directory appears here as a directory. We can also look at the contents of parallel folders.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">"../../advent_of_Code2022/scripts/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "day1.R" "day2.R" "day3.R" "day4.R" "day5.R" "day6.R" "day7.R" "day8.R"
[9] "day9.R"</code></pre>
</div>
</div>
<p>In order to easily access most of your files and data, good folder structure is essential, I like to keep master scripts within the general topical folder, with subfolders for both data and results. When saving to these folders, you usually use a dedicated function that relates to the package eco-system that you are using, but the most simple datasets can be saved locally using <code>save</code> function, where you specify your dataset to save, and where you want to save it to. When saving outputs such as LateX tables, ggplot images and such, there are more dedicated functions.</p>
</section>
<section id="added-notes-on-indexing" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="added-notes-on-indexing"><span class="header-section-number">2.9</span> Added Notes on Indexing</h2>
<p>Indexing variables and rows are keys to many of the later functions that will be discussed, and especially in terms of loops. Indexing a variable with the <code>$</code> operator is the same as extracting the vector that constitutes that variable, as such it itself can be indexed with the brackets. Note that since the resulting output is a vector, and therefore unidimensional, you only use one number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard"                   "Grad"                   "Gard Olav"             
[4] "the Notorious G.A.R.D."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>names[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard Olav"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>fav_movie</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Adolescence of Utena" "12 Angry Men"            
[3] "Inception"                "Straight outta Compton"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>fav_movie[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Adolescence of Utena"</code></pre>
</div>
</div>
<p>Additionally, indexing is done primarily through numbers, and these numbers can and often should be, interacted with through object assignments. If I want the same indexed number several times for instance, I can store it as an object variable, maybe as a single letter (i, j, and k are common for this in loops, sometimes x as well),</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># idx for indexer</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>names[idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard Olav"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>happy[idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">## For several numbers, still works fine</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>names[idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard"      "Gard Olav"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span>fav_movie[idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The Adolescence of Utena" "Inception"               </code></pre>
</div>
</div>
</section>
</section>
<section id="simple-analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Simple Analysis</h1>
<p>Before you can use R to conduct data wrangling or very directed plotting, you should utilize some functions to explore the data you are interested in. In this section I will utilize a singular dataset to demonstrate some of the simpler data exploring techniques. The data is a limited portion of the World Value Survey from Japan and South Korea, which I used for my MA thesis, primarily the items relating to political interest, gender, and the degree to which the respondent thinks women are suited for political office.</p>
<p>First thing to address is data import. Based on the type of data applied, you utilize a particular function, usually found in the <code>haven</code> package, or just in base R. The most common datatypes are .csv for comma separated files, .xlsx files for excel (lots of strange things can happen when reading these files, be mindful), .sav for stata files, additionally, R has a set of unique filetypes that are relevant, .rda, .rds, and .rdata, .rda and .rdata are loaded with a simple <code>load</code> function, while .rds is read using a <code>readRDS</code> function. Each has an appropriate function for reading the relevant data. Here I already have a prepared dataset ready for analysis that has been appropriately filtered and deliminated through R, and therefore saved as a native R object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Note the file path specification is also very specific. Two dots signal</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="do">## a directory above your current. So this data is found in </span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="do">## the parallell folder MA thesis, which is parallell to the folder one layer</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="do">## above the current directory, then with a specified path to find it.</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../../MA thesis/Data and R scripts/Survey Data/SurvData.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="simple-data-structure-functions" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="simple-data-structure-functions"><span class="header-section-number">3.1</span> Simple data structure functions</h2>
<p>For simplicity’s sake, we can explore the structure of the dataset through just clicking on it in the global environment, the same effect can be achieved by using the <code>view</code> function, either in the console or in the script (but it can get annoying when re-running it inside the script). For a more systematized view of the data, the <code>head</code>, <code>str</code>, and <code>summary</code> functions are often used. <code>head</code> displays the first 6 rows by default (can be modified through the <code>n = 6</code> argument), <code>str</code> shows the structure of the object, and <code>summary</code> prints a general summary of the object (the structure of the summary depends on the type of object). Note that summary works on practically every type of complex object in R. Try them on your own data, but I will utilize head here, because it looks the best in this type of document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SurvData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  gender PartyMember PolDisc  year interest whostility voted country
   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  
1      1           3       3  1995        3          2    NA Japan  
2      2           3       3  1995        3          3    NA Japan  
3      2           3       3  1995        3          2    NA Japan  
4      2           3       2  1995        2          3    NA Japan  
5      2           3       3  1995        4         -1    NA Japan  
6      2           3       3  1995        3          2    NA Japan  </code></pre>
</div>
</div>
<p>This dataset is clearly already been processed a bit, since a WVS would probably have far more variables. But for now we can tell that there are a set of variables that could interest us. I often recheck the precise names by calling the <code>names</code> function, which just prints out the names of the columns in the dataset. When specifying columns in tidyverse functions this can be a helpful reminder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gender"      "PartyMember" "PolDisc"     "year"        "interest"   
[6] "whostility"  "voted"       "country"    </code></pre>
</div>
</div>
<p>This is all on an overview level, to give you an idea of what the data looks like and how to further explore it. When it comes to familiarizing yourself with aspects of the dataset, the $ sign for indexing columns becomes helpful. I usually pair this with a <code>table</code> function, or a <code>summary</code> function, which gives me an idea of what the distribution looks like. <code>table</code> creates an overview of the number of observations that have each unique value in a variable (do not use for continous data). For simple interaction exploration, <code>table</code> also accepts several variables so you can see where they overlap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SurvData<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   1.000   2.000   1.517   2.000   2.000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2 
5219 5585 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>gender, SurvData<span class="sc">$</span>whostility)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      -2   -1    1    2    3    4
  1  168  788  527 1887 1533  316
  2  191  883  349 1589 2042  531</code></pre>
</div>
</div>
<p>Another key function to use both when exploring your data, but also when you are troubleshooting issues later, is the <code>class</code> function. Quite simply it tells you what type of data the thing you are entering is. It works both on vectors/variables, which can let you know if you are dealing with a character variable or a numeric one, but also on complex objects in your environment, so you can know whether the object you are using is appropriate for certain functions. For instance, map visualisations usually requires objects of the <code>sf</code> class, not just dataframes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(SurvData<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(SurvData<span class="sc">$</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df_example<span class="sc">$</span>happy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "logical"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(SurvData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Furthermore, you can use some very simple plots to help you view the distribution, such as a density plot, or a histogram for certain values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(SurvData<span class="sc">$</span>whostility))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(SurvData<span class="sc">$</span>whostility)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Additionally, some dataforms have labels attached to their columns, this is normal for data imported from spss, or stata. These labels provide information about the coding, without searching the codebook, these can be found with the <code>attributes</code> function. I load a dataset here, which has this type of labels. This data will also be used later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../../advanced_statistics_phd/my_data/simple_set.rda"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(joined_sets2<span class="sc">$</span>straff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$labels
  Helt enig  Nokså enig     Både og Nokså uenig  Helt uenig    Vet ikke 
          1           2           3           4           5           6 
   Ubesvart 
          9 

$label
[1] "Forebyggende arbeid"

$class
[1] "haven_labelled" "vctrs_vctr"     "double"        </code></pre>
</div>
</div>
<p>It is also in Norwegian, apologies for that. The label is meant to give information about what the variable is, while the labels say what the numbers actually signify, when the surveyed respondent answered the questionnaire. Here we can therefore see that the respondent ranked agreement with a statement on a likert scale. The statement was related to whether or not preventative work is better than punishment to prevent criminal activity.</p>
</section>
</section>
<section id="data-wrangling" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Data wrangling</h1>
<p>Transforming data is (in my opinion) best done through the tidyverse system. The most key aspect of this framework is the usage of the pipe operator <code>%&gt;%</code>, which takes the output from whatever is in front of the pipe, and gives it as the first argument in the function following the pipe (As a sidenote, if you want to call the preceeding object again, you can use a . to put it more places). This is useful because as a general rule, tidyverse functions all have a dataset as the first argument in their functions, and output a dataset from the function, meaning that you can run a function on a dataset, then pipe that into a new function, in a manner that makes more sense for beginners in programming. Tidyverse allows for many useful simplifications, such as selecting columns by names without complex indexing or name wrapping. In this section I will use the dataset previously outlined in the section on simple analysis. I will go through the most common data wrangling functions that I use in my processes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="do">## A simple pipe explanation</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(whostility) <span class="sc">%&gt;%</span> </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.8097</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is the same as </span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">pull</span>(SurvData, whostility), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.8097</code></pre>
</div>
</div>
<p>The code above demonstrates the improved intuity of using tidyverse functions. The code follows your natural progression of treatment of data, whereas the un-tidyversed code you have to start writing with the final function, and it is not easy to extend if you want to add further actions to the data when revising the code. It is easier to start with “I have this dataset”, then writing “I want to do something with <em>this</em> variable” and then “I want to do this function exactly”.</p>
<section id="dealing-with-bad-names" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="dealing-with-bad-names"><span class="header-section-number">4.1</span> Dealing with bad names</h2>
<p>Often times your data imported from excel will have really bad names, rife with capitalization and spacing. Ideally you want a dataset where variables do not have these things, so it is easier to memorize and enter into R. If I face this issue I will often utilize the janitor package, which can clean names into something more coherent. If there is space for instance in the variable name, then it has to be wrapped in the ` signs, which can be complicated to type out when auto-complete is not available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>df_example<span class="sc">$</span><span class="st">`</span><span class="at">This Name is REALLY bad 120</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="st">"BAD"</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "names"                       "age"                        
[3] "fav_movie"                   "happy"                      
[5] "This Name is REALLY bad 120"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df_example <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(df_example)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "names"                       "age"                        
[3] "fav_movie"                   "happy"                      
[5] "this_name_is_really_bad_120"</code></pre>
</div>
</div>
</section>
<section id="mutating" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="mutating"><span class="header-section-number">4.2</span> Mutating</h2>
<p>Mutate is the dplyr function for changing variables in a dataset. This means that the function can both create and modify existing variables in the dataset. As we saw in the last structure of our dataset, the gender variable is operationalized as 1 for men and 2 for women, we usually prefer a binary for this, so let us change that variable in a new dataset. Note that variable selecting in tidyverse functions are often quite straightforward, most if not all functions can specify variables by just writing them out in plain text as seen below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>SurvData <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_subtracted =</span> gender <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Lets compare the outputs to ensure successful transformation</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>gender, SurvData<span class="sc">$</span>gender_subtracted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
       0    1
  1 5219    0
  2    0 5585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Japan South Korea 
       5955        4849 </code></pre>
</div>
</div>
<p>A common thing you might find with your dataset is that the variables have the wrong type. Perhaps a column that was meant to be a number was read as a character, because the idiot who made the excel sheet decided to spell out “no data” in the missing cells (these people should be executed). In many instances the simplest way of changing a variable, is to force it into another class by using an <code>as.</code> function, <code>as.numeric</code>, <code>as.character</code>, <code>as.Date</code>, and <code>as.double</code> are common variations of this. There is also the <code>factor</code> function, which allows you to create ordinal values. Where the <code>as.</code> functions are relatively simple (perhaps except the date one), factor also requires that you supply a vector of the rankings of the factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>SurvData <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_text =</span> <span class="fu">as.character</span>(gender))</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(SurvData<span class="sc">$</span>gender_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SurvData<span class="sc">$</span>gender_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1" "2" "2" "2" "2" "2"</code></pre>
</div>
</div>
<section id="ifelse-and-case-when-mutations" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="ifelse-and-case-when-mutations"><span class="header-section-number">4.2.1</span> Ifelse and Case when mutations</h3>
<p>One of the most common techniques for assigning new values, other than just committing straight mathematical operations on them, is to utilize a logical test to assign new values. The most simple way of doing this is the <code>ifelse</code> function. It, simply put, tests each element of a vector and then assigns a new value based on TRUE or FALSE response, the syntax is as follows <code>ifelse(logicaltest, value_if_TRUE, value_if_FALSE)</code>. If for instance we wanted the new gender variable to be a character based on gender we could do the following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>SurvData <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_ifelsed =</span> <span class="fu">ifelse</span>(gender <span class="sc">==</span> <span class="dv">2</span>, <span class="st">"Woman"</span>, <span class="st">"Man"</span>))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>gender, SurvData<span class="sc">$</span>gender_ifelsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
     Man Woman
  1 5219     0
  2    0  5585</code></pre>
</div>
</div>
<p>This is doable for instances where the new variable is dichotomous, and while it is possible to put a second <code>ifelse</code> function inside the response for the results of the logical test, this can get extremely cluttered as several cases appear. Which is why the dplyr package, helpfully has the <code>case_when</code> function, which is a vectorized version of ifelse, the helpfile will even say so. <code>case_when</code> has a bit more complex of a syntax, where the logical test is followed by a ~ and then the assigned value, with commas separating all cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>SurvData <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_cased =</span> <span class="fu">case_when</span>(  <span class="do">## Style guide recomends this style</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    gender <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Woman"</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Man"</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    gender <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Non-Binary"</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(SurvData<span class="sc">$</span>gender, SurvData<span class="sc">$</span>gender_cased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
     Man Woman
  1 5219     0
  2    0  5585</code></pre>
</div>
</div>
</section>
<section id="across" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="across"><span class="header-section-number">4.2.2</span> Across</h3>
<p>If you have a long set of variables you want to do the same thing to, the <code>across</code> selection function can be very helpful. When used within a mutate function it can apply the same function unto several columns. The function assignment is signalled here with a ~ which is called a “purr-style” lambda function, but other ways of assigning the function is technically possible. The .x following signifies the place the column to change has in the function used in it.</p>
<p>Across can also be extended with anonymous functions (that is technically what is being done behind the scenes), which I will cover later in the document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>vars_i <span class="ot">&lt;-</span> <span class="fu">names</span>(joined_sets2)[<span class="dv">16</span><span class="sc">:</span><span class="dv">29</span>]</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>joined_sets2_mutated <span class="ot">&lt;-</span> joined_sets2 <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(vars_i), <span class="sc">~</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(.x))) <span class="sc">%&gt;%</span> <span class="do">## Heres a fun interaction with haven...</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(vars_i), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">&gt;</span> <span class="fl">2.5</span>, <span class="st">"High"</span>, <span class="st">"Low"</span>)))</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_sets2[,<span class="dv">16</span><span class="sc">:</span><span class="dv">29</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  straff    utkant  likestilling eu      eea   u_hjelp organisasjonsmakt alkohol
  &lt;dbl+lbl&gt; &lt;dbl+l&gt; &lt;dbl+lbl&gt;    &lt;dbl+l&gt; &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+lbl&gt;         &lt;dbl+l&gt;
1 NA        3 [Bad… 4 [Noksa ue… 6 [Vet… NA    5 [Hel… 3 [Bade og]       3 [Bad…
2 NA        4 [Nok… 2 [Noksa en… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     1 [Hel…
3 NA        4 [Nok… 2 [Noksa en… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     2 [Nok…
4 NA        1 [Hel… 2 [Noksa en… 1 [Hel… NA    1 [Hel… 3 [Bade og]       4 [Nok…
5 NA        2 [Nok… 1 [Helt eni… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     1 [Hel…
6 NA        3 [Bad… 1 [Helt eni… 1 [Hel… NA    3 [Bad… 3 [Bade og]       1 [Hel…
# ℹ 6 more variables: forskjeller &lt;dbl+lbl&gt;, int_lvl &lt;dbl+lbl&gt;,
#   off_tjen &lt;dbl+lbl&gt;, krist &lt;dbl+lbl&gt;, innvandring &lt;dbl+lbl&gt;, klima &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Compared with</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_sets2_mutated[,<span class="dv">16</span><span class="sc">:</span><span class="dv">29</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  straff utkant likestilling eu    eea   u_hjelp organisasjonsmakt alkohol
  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;  
1 &lt;NA&gt;   High   High         High  &lt;NA&gt;  High    High              High   
2 &lt;NA&gt;   High   Low          Low   &lt;NA&gt;  High    Low               Low    
3 &lt;NA&gt;   High   Low          Low   &lt;NA&gt;  High    Low               Low    
4 &lt;NA&gt;   Low    Low          Low   &lt;NA&gt;  Low     High              High   
5 &lt;NA&gt;   Low    Low          Low   &lt;NA&gt;  High    Low               Low    
6 &lt;NA&gt;   High   Low          Low   &lt;NA&gt;  High    High              Low    
# ℹ 6 more variables: forskjeller &lt;chr&gt;, int_lvl &lt;chr&gt;, off_tjen &lt;chr&gt;,
#   krist &lt;chr&gt;, innvandring &lt;chr&gt;, klima &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="new-variables-as-vectors" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="new-variables-as-vectors"><span class="header-section-number">4.2.3</span> New variables as vectors</h3>
<p>Recall that a dataframe is practically just a vector of vectors. Each column, or variable is essentially just a vector with the same length as the total dataframe. This means you can also create new variables by creating a vector of the same length and in the same order as the dataframe. Most operations you do on vectors from the dataframe will result in this kind of mergible vector. If I add together the vector-variable of <code>interest</code> and the vector variable <code>poldisc</code>, the result is simply a vector of the same length and in the same order as the dataframe. Therefore, for simple variable changes, it is sometimes easier to just assign it like this, “manually” if you will.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(SurvData<span class="sc">$</span>interest <span class="sc">+</span> SurvData<span class="sc">$</span>PolDisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10804</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Essentially, the following will remain true for 1:rows in dataframe</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>(SurvData<span class="sc">$</span>interest <span class="sc">+</span> SurvData<span class="sc">$</span>PolDisc)[<span class="dv">8092</span>] <span class="sc">==</span> SurvData<span class="sc">$</span>interest[<span class="dv">8092</span>] <span class="sc">+</span> SurvData<span class="sc">$</span>PolDisc[<span class="dv">8092</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>SurvData<span class="sc">$</span>pol_index <span class="ot">&lt;-</span> (SurvData<span class="sc">$</span>PolDisc <span class="sc">+</span> SurvData<span class="sc">$</span>interest)<span class="sc">/</span><span class="dv">2</span> <span class="do">## Making the mean out of the two</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(SurvData<span class="sc">$</span>pol_index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 -1.000   2.000   2.000   2.263   2.500   3.500    5939 </code></pre>
</div>
</div>
</section>
</section>
<section id="subsetting-on-variables" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="subsetting-on-variables"><span class="header-section-number">4.3</span> Subsetting on variables</h2>
<p>Later I will go through the process for selecting away cases by <code>filter</code>, but first, as previously mentioned, there is a family of <code>tidyselect</code> functions, of which the most relevant in our instance is the normal <code>select</code> function. There are two main ways of selecting within this function, you can either select the variables you <em>want</em>, or select away the variables you <em>don’t want</em>. Within a select function, if you write the names of the variables you want, then those are the ones you get in the subset, but if you write a <code>-</code> sign in front, then it means the dataset without that (or those) variable(s).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData) <span class="do">## Note which variables I do have</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "gender"            "PartyMember"       "PolDisc"          
 [4] "year"              "interest"          "whostility"       
 [7] "voted"             "country"           "gender_subtracted"
[10] "gender_text"       "gender_ifelsed"    "gender_cased"     
[13] "pol_index"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First I only want country, gender and whostility</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>SurvData_sub <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, gender, whostility)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData_sub)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country"    "gender"     "whostility"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now lets select away PolDisc and interest</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>SurvData_sub <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PolDisc, <span class="sc">-</span>interest)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "gender"            "PartyMember"       "year"             
 [4] "whostility"        "voted"             "country"          
 [7] "gender_subtracted" "gender_text"       "gender_ifelsed"   
[10] "gender_cased"      "pol_index"        </code></pre>
</div>
</div>
<p>Selecting in tidyverse is also supported by a range of other specific tidyselect functions, which allows you to select certain variables based on a pattern, such as the <code>starts_with</code> function, which selects all variables that start with a specified string pattern. If you have a vector of your variable names you can also use the <code>all_of</code> function to select all of those. This might not seem so useful here, but a general recommendation is that if you are repeating a process more than twice, it is always useful to write a simpler process like a function or a variable for it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>vars_i_want <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"country"</span>, <span class="st">"whostility"</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>SurvData_sub <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(vars_i_want))</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gender"     "country"    "whostility"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="do">### On a pattern with starts_with</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>SurvData_sub <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"gender"</span>))</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SurvData_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gender"            "gender_subtracted" "gender_text"      
[4] "gender_ifelsed"    "gender_cased"     </code></pre>
</div>
</div>
</section>
<section id="filtering" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="filtering"><span class="header-section-number">4.4</span> Filtering</h2>
<p>The second common thing to do when treating data is to filter it, keeping only certain observations. Again you would use a logical test in order to filter these things, so get used to writing these sorts of tests. I showed earlier that the data had two countries, lets make a new dataframe with only Japan. Note also that this function will remove lines, and as such, you should not overwrite the old dataframe when filtering, like I did in the mutate section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>jap_surv <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"Japan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can add more tests to filter it further, either with a binding logical operator, or a comma, but comma adds strict additional requirement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>jap_surv_w <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"Japan"</span>, gender_ifelsed <span class="sc">==</span> <span class="st">"Woman"</span>)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(jap_surv_w<span class="sc">$</span>country, jap_surv_w<span class="sc">$</span>gender_ifelsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       
        Woman
  Japan  3142</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>women_or_japanese <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> <span class="st">"Japan"</span> <span class="sc">|</span> gender_ifelsed <span class="sc">==</span> <span class="st">"Woman"</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(women_or_japanese<span class="sc">$</span>country, women_or_japanese<span class="sc">$</span>gender_ifelsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             
               Man Woman
  Japan       2813  3142
  South Korea    0  2443</code></pre>
</div>
</div>
</section>
<section id="grouping-and-aggregating" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="grouping-and-aggregating"><span class="header-section-number">4.5</span> Grouping and Aggregating</h2>
<p>A common need is also to use lower level data to create data on summaries of aggregate level, like the average level of women respondents across the survey years. This also has a slightly complex syntax, but you first group the dataframe with the function <code>group_by</code>, which specifies a set of variables that units should be grouped into, and then feed that into the <code>summarise</code> (<code>summarize</code> works too for americans) function, which specifies the new variables you want to create on the aggregate level. These new variables need to be specified by functions that summarise elements however, such as <code>mean</code>. In this code I will make an aggregate of Japan and South Korea over the time periods, with the number of respondents in each, and the average degree of anti-women legislator sentiment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>grouped_f <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">whostility =</span> <span class="fu">ifelse</span>(whostility <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, whostility)) <span class="sc">%&gt;%</span>  <span class="co"># You can add the unchanged vector as a responsein an ifelse, Values less than 0 are missing categories in WVS</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span> </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">respondents =</span> <span class="fu">n</span>(),</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">whostility =</span> <span class="fu">mean</span>(whostility, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grouped_f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   country [2]
  country      year respondents whostility
  &lt;chr&gt;       &lt;dbl&gt;       &lt;int&gt;      &lt;dbl&gt;
1 Japan        1995        1054       2.35
2 Japan        2000        1362       2.60
3 Japan        2005        1096       2.56
4 Japan        2010        2443       2.60
5 South Korea  1996        1249       2.27
6 South Korea  2001        1200       2.53</code></pre>
</div>
</div>
<p>Given that grouping is part of tidyverse, we can also use tidyselect within it. Lets say I want the mean of several variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>my_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PolDisc"</span>, <span class="st">"interest"</span>, <span class="st">"whostility"</span>)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>grouped_more <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(my_vars), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="cn">NA</span>, .x))) <span class="sc">%&gt;%</span> </span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span> </span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(my_vars), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grouped_more)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
# Groups:   country [2]
  country      year PolDisc interest whostility
  &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 Japan        1995    2.39     2.43       2.35
2 Japan        2000    2.28     2.26       2.60
3 Japan        2005  NaN        2.27       2.56
4 Japan        2010  NaN        2.24       2.60
5 South Korea  1996    2.03     2.37       2.27
6 South Korea  2001    2.16     2.52       2.53</code></pre>
</div>
</div>
<p>Here we see a NaN example, where a mean of nothing is not a number, since we specified na.rm to be true. This is because the question PolDisc was not asked in 2005 and 2010 for Japan, so all observations are NA, when NA’s are filtered out from na.rm, this then leaves the mean of nothing, which is not a number.</p>
</section>
<section id="joining" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="joining"><span class="header-section-number">4.6</span> Joining</h2>
<p>The most common iteration of joining is the <code>left_join</code> function. This joins a secondary dataset to the right of the first dataset. In order to join the datasets you must specify a set of “keys”, a set of variables which the values in the left dataset is supposed to match to the right dataset. These do not have to create an exact match between datasets, multiple points in the original set can match single values in the joining set, but the reverse makes things complicated. If a single row in the original set matches multiple rows of the new one, then duplicates are created. For this reason make sure that the original dataset is either on a sub-level hierarchically, or that there are unique and exact matches in the new dataset.</p>
<p>The most common scenario to join values in my experience is when you have aggregate data that you want to join in to individual level data. Say I have survey result data from certain countries, and I want to join in some contextual variables. I could match that on just country and year variables. Below I utilize the survey in Norwegian parties, first I aggregate a frame, then join it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>joined_lim <span class="ot">&lt;-</span> joined_sets2 <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eu =</span> <span class="fu">ifelse</span>(eu <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), eu, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(kjonn, parti, tid, eu)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>joined_lim_agg <span class="ot">&lt;-</span> joined_sets2 <span class="sc">%&gt;%</span> </span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eu =</span> <span class="fu">ifelse</span>(eu <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), eu, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parti, tid) <span class="sc">%&gt;%</span> </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_eu =</span> <span class="fu">mean</span>(eu, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>joined_lim[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">64</span>,<span class="dv">65</span>,<span class="dv">556</span>,<span class="dv">557</span>,<span class="dv">1231</span>,<span class="dv">1232</span>,<span class="dv">5688</span>, <span class="dv">5689</span>,<span class="dv">6783</span>, <span class="dv">6784</span>),] <span class="do">## Indexing some random rows, so we can see variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   kjonn       parti   tid    eu
   &lt;dbl+lbl&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
 1  1 [Mann]   FrP    1991     1
 2  1 [Mann]   FrP    1991     1
 3  2 [Kvinne] KrF    1991     5
 4  2 [Kvinne] KrF    1991     5
 5  2 [Kvinne] V      1991     4
 6  2 [Kvinne] V      1991     5
 7  1 [Mann]   V      1991     3
 8  2 [Kvinne] V      1991     5
 9  2 [Kvinne] V      2009     3
10  1 [Mann]   V      2009     4
11  2 [Kvinne] FrP    2009     5
12 NA          FrP    2009     5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>joined_lim_joined <span class="ot">&lt;-</span> joined_lim <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(joined_lim_agg, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"parti"</span>, <span class="st">"tid"</span>)) <span class="co"># Here i join in the new set, i know that the parti and tid variables are in both sets</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>joined_lim_joined[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">64</span>,<span class="dv">65</span>,<span class="dv">556</span>,<span class="dv">557</span>,<span class="dv">1231</span>,<span class="dv">1232</span>,<span class="dv">5688</span>, <span class="dv">5689</span>,<span class="dv">6783</span>, <span class="dv">6784</span>),] <span class="do">## Indexing the same numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
   kjonn       parti   tid    eu mean_eu
   &lt;dbl+lbl&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1  1 [Mann]   FrP    1991     1    2.02
 2  1 [Mann]   FrP    1991     1    2.02
 3  2 [Kvinne] KrF    1991     5    4.44
 4  2 [Kvinne] KrF    1991     5    4.44
 5  2 [Kvinne] V      1991     4    4.16
 6  2 [Kvinne] V      1991     5    4.16
 7  1 [Mann]   V      1991     3    4.16
 8  2 [Kvinne] V      1991     5    4.16
 9  2 [Kvinne] V      2009     3    3.03
10  1 [Mann]   V      2009     4    3.03
11  2 [Kvinne] FrP    2009     5    3.08
12 NA          FrP    2009     5    3.08</code></pre>
</div>
</div>
<p>Since <code>mean_eu</code> was the only variable in the aggregated set except the key variables <code>parti</code> and <code>tid</code>, this is the only new column in the merged dataset.</p>
<p><code>left_join</code> is by far the most common way of joining a dataset when you want new information or elements to be added to your existing dataset. There also exist <code>right_join</code> and <code>full_join</code>, but <code>right_join</code> is practically the same as left, just less intuitive and more niche in my opinion, while <code>full_join</code> should not be used because I can rarely think of a scenario where it makes sense to use in relation to dataset specifications.</p>
<p>The other relevant form of merging is when you have new data that is identical in structure to the old data, but they represent perhaps new observations to that data. In this instance you seek to bind the rows together, and suitably the function is just called <code>bind_rows</code>, if the datasets are structured properly, then you can just enter two datasets in that function and it should merge them. If they are not similar, you have to data wrangle them a bit. Perhaps the newer frame from a later survey coded all their numerical responses as character vectors, then you have to make sure that the columns of this variable have consistent datatypes, because R will not do that work for you.</p>
</section>
<section id="pivoting" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="pivoting"><span class="header-section-number">4.7</span> Pivoting</h2>
<p>Say we have a dataset where differences in years are stored in columns, and we want a single row for each yearly observation. Or we have data that is more extensive than we want, and we want to limit the number of rows. This can be achieved through pivot functions, primarily <code>pivot_wider</code> and <code>pivot_longer</code> which have fairly intuitive names, they make the dataframe wider or longer, by making it shorter or narrower, respectively. The way to use them is to feed a dataframe into it, with a pipe of course, and then, depending on wider or narrower, you have to specify which columns the names go to or from, and where the values go to and from. For a wider pivot, the new names are all a class of variables, such as a character string for instance, when specifying <code>names_from</code>, this is the variable that the new columns will be named after.</p>
<p>Lets use a different dataset for a more applicable situation. I am here loading a dataset from a survey which is meant to measure agreement within party structures, I transform the question values to instead be distance to the mean of the party.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Will limit this dataset to only a single party, and a couple of questions and key variables</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Ignore the complex code, it might make sense later</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>vars_i <span class="ot">&lt;-</span> <span class="fu">names</span>(joined_sets2)[<span class="dv">16</span><span class="sc">:</span><span class="dv">29</span>] <span class="do">## I know columns 16:29 are the ones I want</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>mean_values_for_transf <span class="ot">&lt;-</span> joined_sets2 <span class="sc">%&gt;%</span> </span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(parti, tid, <span class="fu">all_of</span>(vars_i)) <span class="sc">%&gt;%</span> </span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parti, tid) <span class="sc">%&gt;%</span> </span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(vars_i), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(vars_i), <span class="at">names_to =</span> <span class="st">"question"</span>, <span class="at">values_to =</span> <span class="st">"mean_vals"</span>)</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mean_values_for_transf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
# Groups:   parti [1]
  parti   tid question     mean_vals
  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
1 Ap     1991 straff          NaN   
2 Ap     1991 utkant            1.81
3 Ap     1991 likestilling      1.69
4 Ap     1991 eu                4.17
5 Ap     1991 eea             NaN   
6 Ap     1991 u_hjelp           3.67</code></pre>
</div>
</div>
<p>Note that we now only have four variables, but far more rows, instead of each question being a variable, each question is now a row for an individual. Lets do the same for the un-summarised version, then <code>left_join</code> this aggregate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>joined_sets2_i <span class="ot">&lt;-</span>joined_sets2</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>joined_sets2_i<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(joined_sets2) <span class="do">## If you want a fun story, ask why this is here........</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>new_joined <span class="ot">&lt;-</span> joined_sets2_i <span class="sc">%&gt;%</span> </span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(vars_i), <span class="sc">~</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(.x)),</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">all_of</span>(vars_i), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="sc">!</span>(.x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)), <span class="cn">NA</span>, .x))) <span class="sc">%&gt;%</span>  <span class="do">## Likert scale, so outside 1-5 is missing vals</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(vars_i), <span class="at">names_to =</span> <span class="st">"question"</span>, <span class="at">values_to =</span> <span class="st">"q_response"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mean_values_for_transf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"parti"</span>, <span class="st">"tid"</span>, <span class="st">"question"</span>)) <span class="do">## Note the join so that the mean vals for the questions is there as well</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(new_joined) <span class="do">## Gets the dimensions of the object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 136010     23</code></pre>
</div>
</div>
<p>As you can see the new frame has 136010 rows, and 23 columns, longer and narrower than the original one. Let’s now turn that frame back to the original set, but now with “distance from party-year mean” as the variable on each question. Note that <code>pivot_longer</code> requires you to specify the columns that should be pivoted from, in addition to their destination, while <code>pivot_wider</code> knows that the names are going to be column names, and the values fill columns. That was poorly worded, remind me to come back to that and make it make sense.</p>
<p>As a sidenote, this section had to go through several revisions, because nothing works on first attempt, so do not be fooled into thinking this is an easy process, but practice makes perfect, and by using this language for yourself you eventually become quite apt at finding the source of your mistakes (and very good at googling).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>dist_means_joined <span class="ot">&lt;-</span> new_joined <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist_score =</span> q_response <span class="sc">-</span> mean_vals) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>q_response, <span class="sc">-</span>mean_vals) <span class="sc">%&gt;%</span> <span class="do">### Removing these because they are reduntant and would create strange frames</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"question"</span>, <span class="at">values_from =</span> <span class="st">"dist_score"</span>)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_sets2[,vars_i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  straff    utkant  likestilling eu      eea   u_hjelp organisasjonsmakt alkohol
  &lt;dbl+lbl&gt; &lt;dbl+l&gt; &lt;dbl+lbl&gt;    &lt;dbl+l&gt; &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+lbl&gt;         &lt;dbl+l&gt;
1 NA        3 [Bad… 4 [Noksa ue… 6 [Vet… NA    5 [Hel… 3 [Bade og]       3 [Bad…
2 NA        4 [Nok… 2 [Noksa en… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     1 [Hel…
3 NA        4 [Nok… 2 [Noksa en… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     2 [Nok…
4 NA        1 [Hel… 2 [Noksa en… 1 [Hel… NA    1 [Hel… 3 [Bade og]       4 [Nok…
5 NA        2 [Nok… 1 [Helt eni… 1 [Hel… NA    5 [Hel… 1 [Helt enig]     1 [Hel…
6 NA        3 [Bad… 1 [Helt eni… 1 [Hel… NA    3 [Bad… 3 [Bade og]       1 [Hel…
# ℹ 6 more variables: forskjeller &lt;dbl+lbl&gt;, int_lvl &lt;dbl+lbl&gt;,
#   off_tjen &lt;dbl+lbl&gt;, krist &lt;dbl+lbl&gt;, innvandring &lt;dbl+lbl&gt;, klima &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dist_means_joined[,vars_i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  straff utkant likestilling    eu   eea u_hjelp organisasjonsmakt alkohol
   &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;             &lt;dbl&gt;   &lt;dbl&gt;
1     NA -0.211        1.23  NA       NA   0.435             0.977   1.17 
2     NA  0.789       -0.772 -1.29    NA   0.435            -1.02   -0.829
3     NA  0.789       -0.772 -1.29    NA   0.435            -1.02    0.171
4     NA -2.21        -0.772 -1.29    NA  -3.56              0.977   2.17 
5     NA -1.21        -1.77  -1.29    NA   0.435            -1.02   -0.829
6     NA -0.211       -1.77  -1.29    NA  -1.56              0.977  -0.829
# ℹ 6 more variables: forskjeller &lt;dbl&gt;, int_lvl &lt;dbl&gt;, off_tjen &lt;dbl&gt;,
#   krist &lt;dbl&gt;, innvandring &lt;dbl&gt;, klima &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="modelling" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Modelling</h1>
<p>I will not spent any considerable time going into modelling here, given that outside of glm and lm, most operations will have a dedicated package with unique instructions that you will simply have to learn on your own. The main family of linear models, OLS estimations, are accessed through the <code>lm</code> function. This function accepts a formula as its first argument, which is specified with the dependent variable, followed by a tilde, then the specification of interest. We always store this as an object, a regression output, which we can interact with through generic functions such as summary, which gives a general output of the regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>SurvData <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">case_when</span>( <span class="do">## Just using year will give a strange intercept</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">1995</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">1996</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2000</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2001</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2005</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>model_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(whostility <span class="sc">~</span> gender_text <span class="sc">+</span> country <span class="sc">+</span> wave <span class="sc">+</span> PolDisc <span class="sc">+</span> interest, <span class="at">data =</span> SurvData)</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = whostility ~ gender_text + country + wave + PolDisc + 
    interest, data = SurvData)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.4824 -0.5197  0.4267  0.8782  2.8226 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         1.57765    0.10353  15.238  &lt; 2e-16 ***
gender_text2        0.21967    0.04171   5.266 1.45e-07 ***
countrySouth Korea  0.76820    0.04195  18.314  &lt; 2e-16 ***
wave                0.02767    0.04117   0.672 0.501501    
PolDisc            -0.02516    0.03334  -0.755 0.450494    
interest           -0.08811    0.02650  -3.325 0.000889 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.43 on 4859 degrees of freedom
  (5939 observations deleted due to missingness)
Multiple R-squared:  0.07146,   Adjusted R-squared:  0.07051 
F-statistic: 74.79 on 5 and 4859 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>From it we can see that women and south koreans in general are less hostile to women as legislators, we can underpin this with an interaction effect. which is specified with a multiplier sign.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>model_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(whostility <span class="sc">~</span> gender_text <span class="sc">+</span> country <span class="sc">+</span> wave <span class="sc">+</span> PolDisc <span class="sc">+</span> interest <span class="sc">+</span> country<span class="sc">*</span>gender_text, <span class="at">data =</span> SurvData)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = whostility ~ gender_text + country + wave + PolDisc + 
    interest + country * gender_text, data = SurvData)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.5528 -0.5528  0.4501  0.9522  2.7519 

Coefficients:
                                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                      1.65152    0.10565  15.631  &lt; 2e-16 ***
gender_text2                     0.07895    0.05859   1.348 0.177844    
countrySouth Korea               0.62420    0.05943  10.502  &lt; 2e-16 ***
wave                             0.03058    0.04113   0.743 0.457285    
PolDisc                         -0.02769    0.03331  -0.831 0.405863    
interest                        -0.08773    0.02647  -3.315 0.000924 ***
gender_text2:countrySouth Korea  0.28011    0.08199   3.417 0.000639 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.428 on 4858 degrees of freedom
  (5939 observations deleted due to missingness)
Multiple R-squared:  0.07369,   Adjusted R-squared:  0.07255 
F-statistic: 64.41 on 6 and 4858 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Effect of South Korea holds, but effect of being a woman becomes insignificant. For binary data we need a link function and a generalized linear model, which can be accesses through the function <code>glm</code> in R. Below I model the outcome of having voted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>SurvData_vot <span class="ot">&lt;-</span> SurvData <span class="sc">%&gt;%</span> </span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(voted)) <span class="sc">%&gt;%</span>  <span class="do">## Filter out all obs that did not vote</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vot_binary =</span> <span class="fu">ifelse</span>(voted <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>logit_m_1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vot_binary <span class="sc">~</span> gender_cased <span class="sc">+</span> country <span class="sc">+</span> wave, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> SurvData_vot)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>logit_m_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vot_binary <span class="sc">~</span> gender_cased <span class="sc">+</span> country <span class="sc">+</span> wave <span class="sc">+</span> whostility, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> SurvData_vot)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>logit_m_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vot_binary <span class="sc">~</span> gender_cased <span class="sc">+</span> country <span class="sc">+</span> wave <span class="sc">+</span> whostility <span class="sc">+</span> interest, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> SurvData_vot)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>huxtable<span class="sc">::</span><span class="fu">huxreg</span>(logit_m_1, logit_m_2, logit_m_3) <span class="do">## This is where I would normally use stargazer </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="huxtable" data-quarto-disable-processing="true" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-43">
<colgroup><col><col><col><col></colgroup><tbody><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(3)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.745 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.722 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.129 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.231)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.231)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.257)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">gender_casedWoman</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.327 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.336 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.227 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.056)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.056)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.057)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">countrySouth Korea</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.005&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.079&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.215 **&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.058)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.062)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.066)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">wave</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.816 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.828 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.882 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.060)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.060)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.062)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">whostility</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.058 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.040 *&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.017)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.018)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">interest</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.556 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.036)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5939&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5939&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5939&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">logLik</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3748.062&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3742.470&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-3610.273&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">AIC</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7504.123&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7494.940&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7232.545&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="4" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</tbody></table>

</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>                          <span class="do">## But stargazer does not work in quarto html outputs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Plotting</h1>
<p>To paraphrase the Beatles, all you need is ggplot. This framework allows you to plot essentially everything, although some packages obviously makes this plotting simpler, but most of them are just wrappers for ggplot code (even some python and Julia packages use ggplot in R as a backend). You could write entire books worth of information on plotting with ggplot. In fact someone did, I have it if you’re interested.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/healy_vis.jpeg" class="img-fluid figure-img"></p>
<figcaption>neat book</figcaption>
</figure>
</div>
<section id="layers" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="layers"><span class="header-section-number">6.1</span> Layers</h2>
<p>It is prudent to think of visualisations in ggplot as layered. These layers are bound together with plus signs, and each construct a layer ontop of the plot or other visualisation you want to make.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/gglayers.png" class="img-fluid figure-img"></p>
<figcaption>layers of ggplot, stolen from: https://lfoswald.github.io/2021-spring-stats2/materials/session-3/03-online-tutorial/</figcaption>
</figure>
</div>
<p>The most basic general layer that all ggplots need is the base layer of the <code>ggplot</code> function itself. In this function you specify your dataset, and the general aesthetics. Within the <code>ggplot</code> function (and most <code>geom_</code> derivatives) there is an <code>aes</code> argument, this is an aesthetic argument, it specifies what variable from the dataset should represent what element of the plot. Based on the plot type the type of aesthetic accepted varies, but a list of potential aesthetics are: x, y, color, fill, shape, size, linewidth, linetype, etc. Following this, you add a layer that specifies what type of plot you want, this is done through a family of <code>geom_</code> functions such as <code>geom_point</code> for scatterplot, <code>geom_bar</code> for a barplot, <code>geom_boxplot</code> for a boxplot with distributions, etc. Which you use depends on how you want to visualise. If you are curious about the options, type <code>geom_</code> in R, and switch through the optins that it auto-completes to. Lets use this information to build a scatterplot of the first grouped dataframe created earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>grouped_f <span class="sc">%&gt;%</span> <span class="do">### Obviously you can pipe it in </span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>whostility, <span class="at">color =</span> country)) <span class="sc">+</span> </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Very ugly, but it does the job. We can now add a couple of layers to improve the look. There are several themes that can be used by default, such as <code>theme_bw</code> which is my favourite, just add the function in a layer. Additionally we can modify the labels of the plot through the <code>lab</code> function as a separate layer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>grouped_f <span class="sc">%&gt;%</span> </span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y=</span>whostility, <span class="at">color =</span> country)) <span class="sc">+</span> </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Here's a Title"</span>, <span class="at">x =</span> <span class="st">"Time period"</span>, <span class="at">y =</span> <span class="st">"Anti-women sentiment"</span>, <span class="at">color =</span> <span class="st">"Region"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the final plot, I will also do some changes to the datastructure so that it visualises a bit better, there’s perhaps too much space between the timings as it is. Additionally, I think the points are too small, so I will change them manually through arguments fed through the layers. Finally, I also add a <code>geom_line</code> which when combined in this instance, draws a line between the points, separated by the color specification, by default, <code>geom_</code> functions inherit their aesthetic from the layer previous, so the same <code>aes</code> specification is inherited from the higher level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>grouped_f <span class="sc">%&gt;%</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">case_when</span>(             <span class="do">### Mutating to better cases, so they are parallel</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">1995</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">1996</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2000</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2001</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2005</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>wave, <span class="at">y =</span> whostility, <span class="at">color =</span> country)) <span class="sc">+</span>  <span class="do">### Setting aesthetic</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Scatterplot, with 2 as size of the dots</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>          <span class="co"># make a line, inherits past aesthetics</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span>        <span class="co"># theme_bw is the best</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"goldenrod"</span>)) <span class="sc">+</span>  <span class="do">## Values are assigned alphabetically when set manually, so Japan gets first colour</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hostility towards women as legislators"</span>, <span class="at">x =</span> <span class="st">"WVS Wave"</span>, <span class="at">y =</span> <span class="st">"Hostility"</span>) <span class="do">## Creating labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The values and precise aesthetics of a variable can be set with the function family <code>scale_AESTHETIC_TYPE</code>, which provides a large range of ways to modify the aesthetics. In the plot above I manually (therefore manual at the end) assign two values to the color aesthetic (therefore color in the middle). This function family can also modify labels and other elements.</p>
<p>We can also save the resulting plot, by assigning it to an object, and using the dedicated ggsave function, which allows for a ton of useful settings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>plot_obj <span class="ot">&lt;-</span> grouped_f <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">case_when</span>(             <span class="do">### Mutating to better cases, so they are parallel</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">1995</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">1996</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2000</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2001</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2005</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>wave, <span class="at">y =</span> whostility, <span class="at">color =</span> country)) <span class="sc">+</span>  <span class="do">### Setting aesthetic</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Scatterplot, with 2 as size of the dots</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>          <span class="co"># make a line, inherits past aesthetics</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span>        <span class="co"># theme_bw is the best</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"goldenrod"</span>)) <span class="sc">+</span>  <span class="do">## Values are assigned alphabetically when set manually, so Japan gets first colour</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hostility towards women as legislators"</span>, <span class="at">x =</span> <span class="st">"WVS Wave"</span>, <span class="at">y =</span> <span class="st">"Hostility"</span>) <span class="do">## Creating labels</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plot_obj.jpeg"</span>, <span class="at">plot =</span> plot_obj, <span class="at">device =</span> <span class="st">"jpeg"</span>, <span class="at">path =</span> <span class="st">"./images"</span>,</span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">12.5</span>, <span class="at">height =</span> <span class="fl">7.5</span>)</span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a><span class="do">## and now its here, contrast with earlier listes files in images</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">"./images/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bad_stuff.png"         "gglayers.png"          "healy_vis.jpeg"       
[4] "heres_quarto.png"      "outliners.png"         "plot_obj.jpeg"        
[7] "rstudio_default.png"   "yaml_example_word.png" "yaml_header.png"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">"./images/plot_obj.jpeg"</span>) <span class="do">## Just removing it </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maps" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="maps"><span class="header-section-number">6.2</span> Maps</h2>
<p>You can also utilize the ggplot package, in conjunction with the sf package, to visualise maps. This requires shapefiles, which describes the general outlines of some countries. These can also be accessed through several packages, or downloaded from gadm manually. There are a lot of intricacies involving maps and shapefiles in general, but to use it with ggplot it is most common to have it as a <code>sf</code> type file, you can see that the map assignment in the code chunk below is piped into a <code>st_as_sf</code> function, this transform the <code>tera</code> (I believe it is) class object, into an <code>sf</code> class object. In some instances we would have to assign a crs as well, but that’s perhaps too much complicated to talk about right now. Note also that the <code>ggplot</code> layer is itself empty, because the data and aesthetic mapping needs to be from a shapefile function of <code>geom_sf</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geodata) <span class="co"># gadm function can download shapefile data from gadm's API</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>nor_map <span class="ot">&lt;-</span> <span class="fu">gadm</span>(<span class="at">country =</span> <span class="st">"NO"</span>, <span class="at">level =</span> <span class="dv">1</span>, <span class="at">path =</span> <span class="st">"./"</span>) <span class="sc">%&gt;%</span> <span class="do">## Try running this but swapping to "SE" for a swedish map</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span>  <span class="do">## in map data the ggplot is empty</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nor_map) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Aesthetics are possible, filling the map to make a choropleth for instance. You can also left join data that are not of a GIS character straight into this dataframe, then use those variables as aesthetics, but for now lets just make a new variable based on whether I have visited the county.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>nor_map <span class="ot">&lt;-</span> nor_map <span class="sc">%&gt;%</span> </span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">me_there =</span> <span class="fu">case_when</span>(</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.AA"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.AK"</span> <span class="sc">~</span> <span class="st">"Home"</span>,</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.BU"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.FI"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.HE"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.HO"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.MR"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.NO"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.NT"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OF"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OP"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OS"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.RO"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.SF"</span> <span class="sc">~</span> <span class="st">"Home"</span>,</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.ST"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.TE"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.TR"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.VA"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.VF"</span> <span class="sc">~</span> <span class="st">"Yes"</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nor_map, <span class="fu">aes</span>(<span class="at">fill =</span> me_there)) <span class="sc">+</span> </span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span>                                                  <span class="do">## Removes the coordinate lines seen in the first one</span></span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mitt lille land"</span>, <span class="at">fill =</span> <span class="st">"Have I been?"</span>) <span class="sc">+</span> </span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"goldenrod"</span>, <span class="st">"firebrick"</span>, <span class="st">"cornflowerblue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that the aesthetic argument is <code>fill</code> not <code>colour</code> (I have done that mistake several times).</p>
<p>Often you will also want labels on the geographical points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>nor_map <span class="ot">&lt;-</span> nor_map <span class="sc">%&gt;%</span> </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">last_there =</span> <span class="fu">case_when</span>(</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.AA"</span> <span class="sc">~</span> <span class="st">"2017"</span>,</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.AK"</span> <span class="sc">~</span> <span class="st">"2025"</span>,</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.BU"</span> <span class="sc">~</span> <span class="st">"2024"</span>,</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.FI"</span> <span class="sc">~</span> <span class="st">"Never"</span>,</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.HE"</span> <span class="sc">~</span> <span class="st">"2016"</span>,</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.HO"</span> <span class="sc">~</span> <span class="st">"2024"</span>,</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.MR"</span> <span class="sc">~</span> <span class="st">"Never"</span>,</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.NO"</span> <span class="sc">~</span> <span class="st">"Never"</span>,</span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.NT"</span> <span class="sc">~</span> <span class="st">"Never"</span>,</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OF"</span> <span class="sc">~</span> <span class="st">"2025"</span>,</span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OP"</span> <span class="sc">~</span> <span class="st">"2016"</span>,</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.OS"</span> <span class="sc">~</span> <span class="st">"2025"</span>,</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.RO"</span> <span class="sc">~</span> <span class="st">"2013"</span>,</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.SF"</span> <span class="sc">~</span> <span class="st">"2008"</span>,</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.ST"</span> <span class="sc">~</span> <span class="st">"2014"</span>,</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.TE"</span> <span class="sc">~</span> <span class="st">"2013"</span>,</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.TR"</span> <span class="sc">~</span> <span class="st">"Never"</span>,</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.VA"</span> <span class="sc">~</span> <span class="st">"2016"</span>,</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>    HASC_1 <span class="sc">==</span> <span class="st">"NO.VF"</span> <span class="sc">~</span> <span class="st">"2024"</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> nor_map) <span class="sc">+</span> </span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> nor_map, </span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> last_there, <span class="at">geometry =</span> geometry),</span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">stat =</span> <span class="st">"sf_coordinates"</span>) <span class="sc">+</span></span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span>                                                  <span class="do">## Removes the coordinate lines seen in the first one</span></span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Disclosing to much Personal Information"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Clearly too cluttered, this map would need a lot of improvement. Increasing the plot size and decreasing label size might help, but then you run into other issues in regards to visibility. Perhaps this visualisation just is not suited to labels itself? These are aesthetic considerations you should make when creating plots. Remember that plots should be intuitive, and visually easy to understand and get information from.</p>
</section>
</section>
<section id="advanced-methods" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Advanced methods</h1>
<section id="for-loops-and-flow-control" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="for-loops-and-flow-control"><span class="header-section-number">7.1</span> For loops and flow control</h2>
<p>A central part of programming in most languages is the flow control and for loops. For loops in R are slower than most other languages, and usually apply family of functions is preferred, since they can basically function in the same way as for loops, with the right specifications. But knowledge of loops can give you a tool to solve certain difficult tasks where you do not want to spend a couple of hours finding a relevant function. For loops consist of the function <code>for(iterator in sequence)</code> followed by curly brackets <code>{</code> and <code>}</code> which contain the function expression to be repeated. The iterator is the thing that changes with each loop. A for loop is an instruction to do the same task over a set of times.</p>
<p>Below is a simple for loop. First I create a vector of some numbers. In the loop itself, I call the iterator i, and specify that I am looping over a sequence of numbers, from 1 to the length of the vector. I then use that operator as an index to the vector, so that for each iteration of the loop it prints the i vector position squared.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>loopy_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">23</span>,<span class="dv">34</span>,<span class="dv">66</span>,<span class="dv">32</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(loopy_vector)){</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(loopy_vector[i]<span class="sc">^</span><span class="dv">2</span>) <span class="do">### Note that unlike outside the loop, it does not print results automatically</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225
[1] 529
[1] 1156
[1] 4356
[1] 1024</code></pre>
</div>
</div>
<p>For loops have what we call a global scope by default, meaning they can and will interact with global variables, and assignment inside the loops are tracked in the global environment, and change variables you have in your environment, unlike lapply, which usually only changes return values.</p>
<section id="flow-control" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="flow-control"><span class="header-section-number">7.1.1</span> flow control</h3>
<p>For loops are just one version of repeating code, <code>while</code> and <code>repeat</code> also do similar things, however, I have never used them, and highly doubt the reader will do as well.</p>
<p>Flow control refers to ways in which you control a for loop or other similar iterative processes. These keywords are highlighted differently than other keyterms (in my instance they are red (I think, I cant see colours), but it varies with RStudio theme). These words are amonst others:</p>
<ul>
<li><code>if(){}</code> code in the bracket only executed if the logical test within parenthesis returns TRUE, can be followed by else</li>
<li><code>else{}</code> follows the end of the if code bracket, code is executed if the test in the if function is returned as FALSE</li>
<li><code>next</code>, usually nested within an if or else test, skips to the next iteration of the loop.</li>
<li><code>break</code>, exits the loop completely, stopping the iteration over loops, <em>needs</em> to be present in a repeat loop, or it will never stop</li>
<li><code>return</code>, specifies what object or element within the function or loop that should be returned when the iteration is complete, by default the function will return the last object created within it.<br>
</li>
<li><code>switch</code>, is also base highlighted, and is in essence just a baseR version of case_when, but a fair bit more complicated, no need to learn it</li>
<li><code>stop</code>, nested within a statement of sorts, stops a function or loop, and executes an error action, for instance to print out where the error was thrown (oh my god why haven’t I used this more for myself)</li>
<li><code>try</code>, attempts to execute, and will not stop a loop even if failing to execute the code. Can also be modified with error handling programming, and the <code>tryCatch</code> function, which can attempt to catch these errors. Useful for loops where you know certain elements will throw an error.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="do">## showing ifs and elses</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(numbers)){</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(numbers[i] <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"This number: "</span>, numbers[i], <span class="st">", is even!"</span>))</span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"This number: "</span>, numbers[i], <span class="st">", is odd!"</span>))</span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This number: 1, is odd!"
[1] "This number: 2, is even!"
[1] "This number: 3, is odd!"
[1] "This number: 4, is even!"
[1] "This number: 5, is odd!"
[1] "This number: 6, is even!"
[1] "This number: 7, is odd!"
[1] "This number: 8, is even!"
[1] "This number: 9, is odd!"
[1] "This number: 10, is even!"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Showing repeat, and break</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span>{</span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"iterator is now: "</span>, iter, <span class="st">"!"</span>))</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(iter <span class="sc">==</span> <span class="dv">12</span>){</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"oh no, iterator "</span>, iter, <span class="st">" broke the loop! :("</span>))</span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb187-17"><a href="#cb187-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb187-18"><a href="#cb187-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-19"><a href="#cb187-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "iterator is now: 1!"
[1] "iterator is now: 2!"
[1] "iterator is now: 3!"
[1] "iterator is now: 4!"
[1] "iterator is now: 5!"
[1] "iterator is now: 6!"
[1] "iterator is now: 7!"
[1] "iterator is now: 8!"
[1] "iterator is now: 9!"
[1] "iterator is now: 10!"
[1] "iterator is now: 11!"
[1] "oh no, iterator 12 broke the loop! :("</code></pre>
</div>
</div>
</section>
</section>
<section id="functional-programming-with-anonymous-functions" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="functional-programming-with-anonymous-functions"><span class="header-section-number">7.2</span> Functional programming with anonymous functions</h2>
<p>If you are uncertain about how to do certain data wrangling processes, it is always possible to write your own function, or own generic procedure for a single problem. Using the <code>lapply</code> function, or the general family of <code>apply</code> functions, one can assign a very efficient function to be applied over a set of elements in a list. The letter in front usually specifies what type of data you will get back, where <code>lapply</code> is the easiest to use, since it just returns a list, is therefore less likely to throw a merger error. <code>sapply</code> will attempt to return the simplest datatype possible, <code>vapply</code> will return a vector. Note that these types of anonymous functions have a different scope than for loops. All variables within the function exists solely within the function and cannot be called into the global environment. As previously mentioned this can be circumvented with the global environment assignment operator <code>&lt;&lt;-</code> but there is rarely a situation where the usage is necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(loopy_vector, <span class="at">FUN =</span> <span class="cf">function</span>(x){ <span class="do">## x serves here as our "iterator"</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 225

[[2]]
[1] 529

[[3]]
[1] 1156

[[4]]
[1] 4356

[[5]]
[1] 1024</code></pre>
</div>
</div>
<p>Note that the output from the function is a list, with nested singular values, a normal method is to wrap a <code>lapply</code> function in an <code>unlist</code> function, or to feed the <code>lapply</code> to one using a pipe.</p>
<p>I demonstrate a more complex code chunk below, I will create a function that estimates Pi based on Monte Carlo sampling. Note the usage of local variables assigned, as well as the different usages of the iterator. Given that we are “looping” over the vector of different number, the iterator in each sequence becomes the number from the vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>sample_nums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(sample_nums, <span class="cf">function</span>(x){</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  x_coord <span class="ot">&lt;-</span> <span class="fu">runif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)    <span class="do">## Randomly create coordinates in a 1x1 square</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  y_coord <span class="ot">&lt;-</span> <span class="fu">runif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)    <span class="do">## Note i use the x iterator as numbers of samples</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x_coord<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y_coord<span class="sc">^</span><span class="dv">2</span>) <span class="do">## Measure their distance to origin</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>  withiners <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dist <span class="sc">&lt;=</span> <span class="dv">1</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)   <span class="do">## If they have 1 or less in dist, they are inside the circle</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>  pi <span class="ot">&lt;-</span> (<span class="fu">sum</span>(withiners)<span class="sc">*</span><span class="dv">4</span>)<span class="sc">/</span>x <span class="do">## the share of dots inside the circle multiplied by 4 is pi</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>  key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Using "</span>, x, <span class="st">" Samples, Pi is estimated to be "</span>, pi, <span class="st">" (ish)"</span>) <span class="do">## Create a return message</span></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(key)</span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="do">## Unlisting the results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Using 10 Samples, Pi is estimated to be 3.2 (ish)"       
[2] "Using 100 Samples, Pi is estimated to be 2.76 (ish)"     
[3] "Using 1000 Samples, Pi is estimated to be 3.268 (ish)"   
[4] "Using 10000 Samples, Pi is estimated to be 3.146 (ish)"  
[5] "Using 1e+05 Samples, Pi is estimated to be 3.13228 (ish)"</code></pre>
</div>
</div>
<p>For a more practical point, I will demonstrate using a lapply function to create a new variable in our old dataset. Let’s say I want to construct an “anti-establishment” index, which is a function of opposition to EU or EEA, opposition to public services, opposition to gender equality, and extreme position on the left_right scale. In this instance I will utilize an <code>apply</code> function which will go over the rows of the dataset, in only the columns I want. When specifying a margin for the simple <code>apply</code> function, it will take either the rows or columns specified and turn them into vectors, so note that the iterator below can be indexed over, to get the relevant variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>vars_ext <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"eu"</span>, <span class="st">"eea"</span>, <span class="st">"off_tjen"</span>, <span class="st">"likestilling"</span>, <span class="st">"left_right"</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>joined_sets2<span class="sc">$</span>anti_establishment <span class="ot">&lt;-</span> <span class="fu">apply</span>(joined_sets2[, vars_ext], <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="do">## Margin argument specifies to view each extract by row or column</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>                                           opposed_eu <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="do">## If answered 5, completely disagree, then val 1</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>                                           opposed_eea <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x[<span class="dv">2</span>] <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="co"># This one is framed reverse</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>                                           opposed_public <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x[<span class="dv">3</span>] <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>                                           opposed_equal <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x[<span class="dv">4</span>] <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>                                           extreme <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(x[<span class="dv">5</span>] <span class="sc">&gt;</span> <span class="dv">7</span> <span class="sc">|</span> x[<span class="dv">5</span>] <span class="sc">&lt;</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>                                           anti_val <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(opposed_eu, opposed_eea, opposed_public, <span class="co"># index is the mean of these values</span></span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>                                                            opposed_equal, extreme), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">return</span>(anti_val)</span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>                                           </span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>                                         })</span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(joined_sets2<span class="sc">$</span>anti_establishment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                0               0.2              0.25 0.333333333333333 
             2355              2868               974               331 
              0.4               0.5               0.6 0.666666666666667 
             1922               206               703                73 
             0.75               0.8                 1 
               17               153                76 </code></pre>
</div>
</div>
<p>Obviously more complicated operations can be done, but essentially this is here to demonstrate how you take several columns input to make a new variable, a process which can get tricky and complicated within a simple dplyr <code>mutate</code> function.</p>
<p>If you know what you unit you want to do the same thing over and over again for, you do practically anything with an <code>apply</code> function. A good idea is to practice situations with it, because then when you are faced with an unfamiliar problem, you can go straight to work fixing the issue, rather than searching for obscure packages with functions that do the thing you want.</p>
<section id="a-very-complicated-for-loop" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="a-very-complicated-for-loop"><span class="header-section-number">7.2.1</span> A very complicated for loop</h3>
<p>Below is an example of a working loop that would take text information about zambian mp’s and turn them into “spells” or period rows, where each row is an mp’s time in a particular role. There is a heavy use of regular expressions, but the point is to demonstrate how one can go from a brick of text, into a dataset. Try returning to it at some later points, to see how your understanding of the process has improved. The dataset has simply three relevant variables, start, stop, and portfolio. Start is the starting date of the MP’s period in parliament, and stop is the end of their time in this period of parliament. Meanwhile, portfolio is a long text that summarises their career, including roles in government. These roles were described as “… minister of local government (1976-1983)”. The goal of the loop is to then split this info, into rows where each row is one such period, so the previously mentioned portfolio becomes one row for the time the MP spent as a minister of local government, then more rows for the other time periods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>mps2 <span class="ot">&lt;-</span> mps <span class="sc">%&gt;%</span> </span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">as.character</span>(start),</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">stop =</span> <span class="fu">ifelse</span>(stop <span class="sc">==</span> <span class="st">"Active"</span>, <span class="st">"2023-01-01"</span>, stop)) <span class="do">## Turns the start and stop to characters, and replaces "ACTIVE" with current year</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mps2)){</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(mps2<span class="sc">$</span>portfolio[i])){ <span class="do">## If it has no portfolio, then assume the entire period is just an mp, put it back in the list</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>    mps_list[[i]] <span class="ot">&lt;-</span> mps2[i,]</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">str_detect</span>(mps2<span class="sc">$</span>portfolio[i], <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d+(?:</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\</span><span class="st">d+)?</span><span class="sc">\\</span><span class="st">)"</span>)){ <span class="co"># If the portfolio has no (year_start - year_end) parts, then go next</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>    mps_list[[i]] <span class="ot">&lt;-</span> mps2[i,]</span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a>    tm1 <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(mps2<span class="sc">$</span>portfolio[i], <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="do">## First 4 digit number</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>    tm2 <span class="ot">&lt;-</span> <span class="fu">str_extract_all</span>(mps2<span class="sc">$</span>portfolio[i], <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="do">## Second 4 digit number</span></span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>    spells_info_counter <span class="ot">&lt;-</span> <span class="fu">str_count</span>(mps2<span class="sc">$</span>portfolio[i], <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d+(?:</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\</span><span class="st">d+)?</span><span class="sc">\\</span><span class="st">)"</span>) <span class="co"># counting the amount of roles the mp has had</span></span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>    t_start <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(mps2<span class="sc">$</span>start[i], <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>) <span class="co"># extracting the total period start</span></span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a>    t_end <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(mps2<span class="sc">$</span>stop[i], <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>) <span class="co"># and end</span></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(tm1 <span class="sc">==</span> t_start <span class="sc">&amp;</span> tm2 <span class="sc">==</span> t_end <span class="sc">&amp;</span> <span class="sc">!</span>(<span class="fu">is.na</span>(tm2))){ <span class="co"># if they are equal, then the role covers the entire period</span></span>
<span id="cb195-28"><a href="#cb195-28" aria-hidden="true" tabindex="-1"></a>      mps_list[[i]] <span class="ot">&lt;-</span> mps2[i,] <span class="co"># return to the list, go next</span></span>
<span id="cb195-29"><a href="#cb195-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb195-30"><a href="#cb195-30" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb195-31"><a href="#cb195-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-32"><a href="#cb195-32" aria-hidden="true" tabindex="-1"></a>      spell_list <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># create an empty list to put all the roles into</span></span>
<span id="cb195-33"><a href="#cb195-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-34"><a href="#cb195-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>spells_info_counter){ <span class="co"># for every time it found a role </span></span>
<span id="cb195-35"><a href="#cb195-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-36"><a href="#cb195-36" aria-hidden="true" tabindex="-1"></a>        curr_span <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">str_extract_all</span>(<span class="fu">str_extract_all</span>(mps<span class="sc">$</span>portfolio[i], <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d+(?:</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\</span><span class="st">d+)?</span><span class="sc">\\</span><span class="st">)"</span>)[[<span class="dv">1</span>]][j], <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>))) <span class="co"># get that exact role span</span></span>
<span id="cb195-37"><a href="#cb195-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-38"><a href="#cb195-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(curr_span <span class="sc">&gt;</span> t_end) <span class="sc">|</span> <span class="fu">all</span>(curr_span <span class="sc">&lt;</span> t_start)){ <span class="co"># if it is outside the range of the current row, ignore, go next in the role list</span></span>
<span id="cb195-39"><a href="#cb195-39" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb195-40"><a href="#cb195-40" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb195-41"><a href="#cb195-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-42"><a href="#cb195-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>((<span class="fu">max</span>(curr_span) <span class="sc">==</span> t_start <span class="sc">|</span> <span class="fu">min</span>(curr_span) <span class="sc">==</span> t_end) <span class="sc">&amp;</span> <span class="fu">length</span>(curr_span) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb195-43"><a href="#cb195-43" aria-hidden="true" tabindex="-1"></a>          <span class="cf">next</span></span>
<span id="cb195-44"><a href="#cb195-44" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb195-45"><a href="#cb195-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-46"><a href="#cb195-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-47"><a href="#cb195-47" aria-hidden="true" tabindex="-1"></a>        spell_list[[j]]  <span class="ot">&lt;-</span> mps2[i,] <span class="sc">%&gt;%</span> </span>
<span id="cb195-48"><a href="#cb195-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">role =</span> <span class="fu">str_split</span>(portfolio, <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d{4}(?:</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\</span><span class="st">d{4})?</span><span class="sc">\\</span><span class="st">)"</span>)[[<span class="dv">1</span>]][j], <span class="do">## Find the role, string of everything before the time period identifier</span></span>
<span id="cb195-49"><a href="#cb195-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">role_span =</span> <span class="fu">str_extract_all</span>(portfolio, <span class="st">"</span><span class="sc">\\</span><span class="st">(</span><span class="sc">\\</span><span class="st">d+(?:</span><span class="sc">\\</span><span class="st">-</span><span class="sc">\\</span><span class="st">d+)?</span><span class="sc">\\</span><span class="st">)"</span>)[[<span class="dv">1</span>]][j], <span class="co"># find the span of the role, the (start - stop) string</span></span>
<span id="cb195-50"><a href="#cb195-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">ifelse</span>(<span class="fu">str_extract</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>) <span class="sc">&lt;=</span> t_start, start, <span class="co"># if the start was before this row, then the rowstart is the start</span></span>
<span id="cb195-51"><a href="#cb195-51" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">str_extract</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d{4}"</span>)), <span class="co"># else the actual first part of the (start-stop) string</span></span>
<span id="cb195-52"><a href="#cb195-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stop  =</span> <span class="fu">ifelse</span>(<span class="fu">str_count</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">str_extract</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), <span class="co"># same with stop, but for the end</span></span>
<span id="cb195-53"><a href="#cb195-53" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(<span class="fu">str_extract_all</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>] <span class="sc">&gt;=</span> t_end,</span>
<span id="cb195-54"><a href="#cb195-54" aria-hidden="true" tabindex="-1"></a>                                       stop,</span>
<span id="cb195-55"><a href="#cb195-55" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">str_extract_all</span>(role_span, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])),</span>
<span id="cb195-56"><a href="#cb195-56" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">as.Date</span>(<span class="fu">ifelse</span>(<span class="fu">is.numeric</span>(start), start,</span>
<span id="cb195-57"><a href="#cb195-57" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">as.Date</span>(<span class="fu">paste0</span>(start, <span class="st">"-1-1"</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)), <span class="co"># turn it in to the Date format</span></span>
<span id="cb195-58"><a href="#cb195-58" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">origin =</span> <span class="st">"1970-01-01"</span>),</span>
<span id="cb195-59"><a href="#cb195-59" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stop =</span> <span class="fu">as.Date</span>(<span class="fu">ifelse</span>(<span class="fu">is.numeric</span>(stop), stop,</span>
<span id="cb195-60"><a href="#cb195-60" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">as.Date</span>(<span class="fu">paste0</span>(stop, <span class="st">"-12-31"</span>), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)),</span>
<span id="cb195-61"><a href="#cb195-61" aria-hidden="true" tabindex="-1"></a>                                <span class="at">origin =</span> <span class="st">"1970-01-01"</span>),</span>
<span id="cb195-62"><a href="#cb195-62" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start =</span> <span class="fu">as.character</span>(start), <span class="co"># turn that into text again, so we have exact dates to work with</span></span>
<span id="cb195-63"><a href="#cb195-63" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stop =</span> <span class="fu">as.character</span>(stop)</span>
<span id="cb195-64"><a href="#cb195-64" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb195-65"><a href="#cb195-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-66"><a href="#cb195-66" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb195-67"><a href="#cb195-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-68"><a href="#cb195-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is_empty</span>(spell_list)){ <span class="co"># if it for some reason returned empty, cause no periods to loop over, they were just an elected member in this period</span></span>
<span id="cb195-69"><a href="#cb195-69" aria-hidden="true" tabindex="-1"></a>        mps_list[[i]] <span class="ot">&lt;-</span> mps2[i,] <span class="sc">%&gt;%</span> </span>
<span id="cb195-70"><a href="#cb195-70" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">role =</span> <span class="st">"Elected Member"</span>)</span>
<span id="cb195-71"><a href="#cb195-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb195-72"><a href="#cb195-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb195-73"><a href="#cb195-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-74"><a href="#cb195-74" aria-hidden="true" tabindex="-1"></a>      speller_list <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(spell_list) <span class="co"># turn the roles into a list</span></span>
<span id="cb195-75"><a href="#cb195-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-76"><a href="#cb195-76" aria-hidden="true" tabindex="-1"></a>      Y_Periods <span class="ot">&lt;-</span> speller_list <span class="sc">%&gt;%</span> </span>
<span id="cb195-77"><a href="#cb195-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">as.Date</span>(start, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb195-78"><a href="#cb195-78" aria-hidden="true" tabindex="-1"></a>               <span class="at">stop =</span> <span class="fu">as.Date</span>(stop, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span>  <span class="do">## Back into dates again</span></span>
<span id="cb195-79"><a href="#cb195-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">int_int =</span> <span class="fu">interval</span>(start,stop)) <span class="sc">%&gt;%</span>  <span class="co"># create an interval between the start and the stop</span></span>
<span id="cb195-80"><a href="#cb195-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(int_int)</span>
<span id="cb195-81"><a href="#cb195-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-82"><a href="#cb195-82" aria-hidden="true" tabindex="-1"></a>      X_Period <span class="ot">&lt;-</span> mps2[i,] <span class="sc">%&gt;%</span> </span>
<span id="cb195-83"><a href="#cb195-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">as.Date</span>(start, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb195-84"><a href="#cb195-84" aria-hidden="true" tabindex="-1"></a>               <span class="at">stop =</span> <span class="fu">as.Date</span>(stop, <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)) <span class="sc">%&gt;%</span>  <span class="do">## Create a frame with the total interval for the row</span></span>
<span id="cb195-85"><a href="#cb195-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">int_int =</span> <span class="fu">interval</span>(start,stop)) <span class="sc">%&gt;%</span> </span>
<span id="cb195-86"><a href="#cb195-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(int_int)</span>
<span id="cb195-87"><a href="#cb195-87" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-88"><a href="#cb195-88" aria-hidden="true" tabindex="-1"></a>      seq_X <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">seq</span>(<span class="fu">int_start</span>(X_Period), <span class="fu">int_end</span>(X_Period), <span class="at">by =</span> <span class="st">"1 day"</span>))</span>
<span id="cb195-89"><a href="#cb195-89" aria-hidden="true" tabindex="-1"></a>      seq_Y <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">do.call</span>(<span class="st">"c"</span>, <span class="fu">lapply</span>(Y_Periods, <span class="cf">function</span>(x)</span>
<span id="cb195-90"><a href="#cb195-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="fu">int_start</span>(x), <span class="fu">int_end</span>(x), <span class="at">by =</span> <span class="st">"1 day"</span>))))</span>
<span id="cb195-91"><a href="#cb195-91" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-92"><a href="#cb195-92" aria-hidden="true" tabindex="-1"></a>      unique_dates_X <span class="ot">&lt;-</span> seq_X[<span class="sc">!</span>seq_X <span class="sc">%in%</span> seq_Y] <span class="do">## find the sequence of time not covered by these roles</span></span>
<span id="cb195-93"><a href="#cb195-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb195-94"><a href="#cb195-94" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is_empty</span>(unique_dates_X)){ <span class="co"># if there are no times they have no role, go next</span></span>
<span id="cb195-95"><a href="#cb195-95" aria-hidden="true" tabindex="-1"></a>        mps_list[[i]] <span class="ot">&lt;-</span> speller_list</span>
<span id="cb195-96"><a href="#cb195-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb195-97"><a href="#cb195-97" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span> {</span>
<span id="cb195-98"><a href="#cb195-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-99"><a href="#cb195-99" aria-hidden="true" tabindex="-1"></a>        lst <span class="ot">&lt;-</span> <span class="fu">aggregate</span>( <span class="do">### Create an aggregate of the timeholes</span></span>
<span id="cb195-100"><a href="#cb195-100" aria-hidden="true" tabindex="-1"></a>          unique_dates_X,</span>
<span id="cb195-101"><a href="#cb195-101" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">list</span>(<span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff.Date</span>(unique_dates_X) <span class="sc">!=</span> <span class="dv">1</span>))),</span>
<span id="cb195-102"><a href="#cb195-102" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x)),</span>
<span id="cb195-103"><a href="#cb195-103" aria-hidden="true" tabindex="-1"></a>          <span class="at">simplify =</span> F)<span class="sc">$</span>x    </span>
<span id="cb195-104"><a href="#cb195-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-105"><a href="#cb195-105" aria-hidden="true" tabindex="-1"></a>        my_ints <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lst, <span class="cf">function</span>(x) <span class="fu">interval</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>])) <span class="do">## Create a new interval of this</span></span>
<span id="cb195-106"><a href="#cb195-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-107"><a href="#cb195-107" aria-hidden="true" tabindex="-1"></a>        l_fram <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">inter_start =</span> <span class="fu">sapply</span>(<span class="fu">lapply</span>(my_ints, <span class="at">FUN =</span> int_start), as.character),</span>
<span id="cb195-108"><a href="#cb195-108" aria-hidden="true" tabindex="-1"></a>                             <span class="at">inter_end =</span> <span class="fu">sapply</span>(<span class="fu">lapply</span>(my_ints, <span class="at">FUN =</span> int_end), as.character))</span>
<span id="cb195-109"><a href="#cb195-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-110"><a href="#cb195-110" aria-hidden="true" tabindex="-1"></a>        new_adds <span class="ot">&lt;-</span> <span class="fu">cbind</span>(mps2[i,], l_fram) <span class="sc">%&gt;%</span>  <span class="do">## Pull a copy of the original row for personal info</span></span>
<span id="cb195-111"><a href="#cb195-111" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">start =</span> inter_start, <span class="at">stop =</span> inter_end, <span class="co"># mutat to end and start from the interval we created.</span></span>
<span id="cb195-112"><a href="#cb195-112" aria-hidden="true" tabindex="-1"></a>                 <span class="at">role =</span> <span class="st">"Elected Member"</span>) <span class="do">## The empty times is when they were just an elected member</span></span>
<span id="cb195-113"><a href="#cb195-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb195-114"><a href="#cb195-114" aria-hidden="true" tabindex="-1"></a>        mps_list[[i]] <span class="ot">&lt;-</span> speller_list <span class="sc">%&gt;%</span> <span class="do">## Add it to the total list</span></span>
<span id="cb195-115"><a href="#cb195-115" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_rows</span>(new_adds)</span>
<span id="cb195-116"><a href="#cb195-116" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb195-117"><a href="#cb195-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb195-118"><a href="#cb195-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb195-119"><a href="#cb195-119" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb195-120"><a href="#cb195-120" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="string-manipulation" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="string-manipulation"><span class="header-section-number">7.3</span> String manipulation</h2>
<p>I will not go into details in this section, but will make it clear that character variables can be utilized in many different ways through what is known as regular expressions or regex, which are lines of very silly text which can be used as pattern matching to strings as data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>this_is_a_string <span class="ot">&lt;-</span> <span class="st">"hi my name is Gard and I have clinical depression, please help"</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Regex looks insane, so when i for instance want to check whether there is a capitalized name in this string</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Now i check the string on a pattern that matches to any substring that </span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="do">## starts with a single capitalized letter followed by 2 or more uncapitalized</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a><span class="do">## letters.</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(this_is_a_string, <span class="st">"[A-Z]{1}[a-z]{2,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Other functions could do similar stuff, like extract the match</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(this_is_a_string, <span class="st">"[A-Z]{1}[a-z]{2,}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gard"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Same but for a comma and then anything</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(this_is_a_string, <span class="st">"</span><span class="sc">\\</span><span class="st">,.*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ", please help"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Anything following a comma, but not the comma</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(this_is_a_string, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">,).*"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] " please help"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the space is still there</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regex can get extremely complex, and string manipulation in general is a very advanced topic in terms of common R usage, I still have to google many of the characters used in these patterns, and to teach away how regex works properly could probably be an entire course or two in and of itself.</p>
</section>
<section id="keyboard-shortcuts-and-tips" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="keyboard-shortcuts-and-tips"><span class="header-section-number">7.4</span> Keyboard shortcuts and tips</h2>
<ul>
<li>ctrl + shift + m gives a pipe %&gt;%</li>
<li>ctrl + shift + n creates a new script, useful for drafting purposes (sometimes)</li>
<li>alt + - gives an assignment operator &lt;-</li>
<li>shift + any arrow key, highlights text as you move the text entry thing</li>
<li>ctrl + shift + left/right highlights while skipping elements, so you can highlight entire words</li>
<li>If you have an entire section highlighted, you can wrap it in “, (, [, etc. By just pressing that button while having the thing highlighted</li>
<li>ctrl + alt + up/down, gives you more cursors, so you can add more than one line at a time. Useful for repeated entries of the same thing</li>
</ul>
<p>There is an extensive style guide, but generally R custom is to use what is called snake case for variable and object naming. The name “SurvData” used earlier violates this by being pascalcase, a strict snake case version would be “surv_data”. point being, avoid upper case letters, bind words with an underscore. Same custom goes for filenaming of R-scripts and datasets.</p>
</section>
<section id="structuring-your-scripts" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="structuring-your-scripts"><span class="header-section-number">7.5</span> Structuring your scripts</h2>
<p>Scripts are there for reproduction, you could technically run your entire code through the console, but scripts exist to ensure that you can reproduce your results, and that others can reproduce your results. For that reason it is a good idea to have a good structure to your scripts. The main elements that you should always keep in mind is: Linearity, outline, readability, and comments. Linearity in this instance refers to a technical requirement as much as a readers requirement. It is common when beginning to write longer scripts, that you start to run elements of the code out of order. That is fine in and of itself, but becomes a problem when you start writing new code in places it does not make sense to, and when code that depends on variables specified later in your script is added. R is almost always run sequentially, if I am reviewing someone else’s script, I will just highlight the entire script, and run all of it. You should ensure that your scripts will run on the first time they are done this way, therefore, be mindful of where your variable specifications are, and of where you change variables, where you create them, and when your output needs them to be used.</p>
<p>Outline in this instance refers to the idea that you separate your script into easily identifiable chunks. This can actually be done in the comments. If you comment 4 or more #, followed by text and then 4 or more # or -, it will create a section in your script, which can be visible from the outline command.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/outliners.png" class="img-fluid figure-img"></p>
<figcaption>outline</figcaption>
</figure>
</div>
<p>You can then use this table of contents to more easily navigate the structure of your script. Additionally, creating such outlines is good to ensure the previously mentioned requirement of linearity.</p>
<p>When it comes to readability, it is important that you take a couple of key steps to ensure that your code is light on the eyes and the code viewer. Remember to have proper spacing between elements of your code, below are a couple of examples of good and bad practice when it comes to writing code with spacing. Note that you should also actively use linespacing to create blocks or separate code from each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>df_example2<span class="ot">&lt;-</span>df_example<span class="sc">%&gt;%</span><span class="fu">filter</span>(happy<span class="sc">==</span><span class="cn">FALSE</span>) <span class="do">## BAD</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>df_example_2 <span class="ot">&lt;-</span> df_example <span class="sc">%&gt;%</span> <span class="fu">filter</span>(happy <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="do">## Good</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Note the spacing between opeerators, but not between parenthesis and text. </span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>df_example2 <span class="ot">&lt;-</span> df_example <span class="sc">%&gt;%</span> <span class="fu">filter</span>(happy <span class="sc">==</span> <span class="cn">FALSE</span>,age <span class="sc">==</span> <span class="dv">27</span>) <span class="do">## BAD</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>df_example_2 <span class="ot">&lt;-</span> df_example <span class="sc">%&gt;%</span> <span class="fu">filter</span>(happy <span class="sc">==</span> <span class="cn">FALSE</span>, age <span class="sc">==</span> <span class="dv">27</span>) <span class="do">## GOOD</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that spacing after the commas, just like normal writing, is good practice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, your code should not be too wide. Perhaps you have noticed a strange grey line running down your script editor. This is the recommended width by posit, the company who makes RStudio. while it is generally fine to break this line once or twice, it should serve as a guide to how wide your script should be, to ensure that it is easy to follow. Linebreaks are automatically spaced in a nice way when you use them inside functions between arguments, as is evident from some of the code demonstrated here. Below is also an example of really bad and embarassing code from my MA thesis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/bad_stuff.png" class="img-fluid figure-img"></p>
<figcaption>really bad stuff</figcaption>
</figure>
</div>
<p>Note the absolute hell that is trying to find out if you have enough parentheses at the end of your mutate function.</p>
<p>Finally, it is good practice to comment your code regularly. A # will turn everything on the line that follows it into a comment. Make sure that you provide the reader with some context as to how you are proceeding.</p>
</section>
<section id="quarto---creating-nice-documents-in-rstudio-with-code" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="quarto---creating-nice-documents-in-rstudio-with-code"><span class="header-section-number">7.6</span> Quarto - creating nice documents in RStudio with code</h2>
<p>The document you are currently reading is made through the quarto framework, which is developed in RStudio. This framework allows for seamless creation of pdf, html, and other types of files, from your RStudio IDE. The outline files for these documents end in .qmd, and you can create a new one from the top corner of your IDE.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/heres_quarto.png" class="img-fluid figure-img"></p>
<figcaption>here</figcaption>
</figure>
</div>
<p>When clicking new quarto document, you will arrive at a prompt to create one of several types of documents, the current one is an html document, but through quarto you can also create latex specified documents (I have a friend who wrote their Master thesis in RStudio, you can also use bibref through it). Quarto can also make presentations through beamer, revealjs and other engines for making presentations (even powerpoint can be made through RStudio). Following the creation of the file, you specify several settings in the YAML header, which is at the top, here you can specify settings that affect the entire document, and the way it is rendered. The YAML header for this document for instance looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/yaml_header.png" class="img-fluid figure-img"></p>
<figcaption>yaml</figcaption>
</figure>
</div>
<p>In the above instance, the document is turned into an html file, which is the type of file which web browsers display, hence why this tutorial is viewable like this in a webpage. Note also that the output html has several subcategories that you can use to edit settings for the document output you want. You can change the <code>output</code> specification into a different type of document, to change what it is knitted into. Do however make sure that the code you are entering is not unique to the filetype you are applying. If you want a LateX style document you specify <code>output: pdf</code>, this requires a LateX implementation, and the TinyTex package to be on your computer (no overleaf here). If you want a word document, you can specify <code>output: docx</code> in the header, and you can make further specifications by indenting it in new lines, such as in the example below, where a reference document which has settings for font types and sizes, is included in addition to the normal output.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/yaml_example_word.png" class="img-fluid figure-img"></p>
<figcaption>example yaml</figcaption>
</figure>
</div>
<p>Every type of output from Quarto has its own unique variations, that you can explore if you choose to go further with them. Here are some helpful pages for each of the main types of outputs. In addition to the normal outputs, you can also create presentations through beamer (a LateX implementation) and revealjs through Quarto.</p>
<ul>
<li>Pdf: https://quarto.org/docs/output-formats/pdf-basics.html</li>
<li>html: https://quarto.org/docs/output-formats/html-basics.html</li>
<li>word: https://quarto.org/docs/output-formats/ms-word.html</li>
<li>Beamer Presentations: https://quarto.org/docs/presentations/beamer.html</li>
<li>revaljs Presentations: https://quarto.org/docs/presentations/revealjs/</li>
</ul>
</section>
<section id="special-environment-section" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="special-environment-section"><span class="header-section-number">7.7</span> Special Environment section</h2>
<p>Quarto has dedicated display for certain elements if you so desire. You might have noticed that throughout this document, some coding terms appear in in <code>special coding font</code>, this is done in text by wrapping the text in the ` marker. This is not the only unique wrapper characteristic of Quarto, for font specification we have * for <em>cursive</em>, and ** for <strong>bold</strong>. But more importantly, the $ sign can be used in text to implement formula type of typesetting. So that you can naturally interweave model language in your writing.</p>
<p>Ex: “Model 1 specifies the dependent variable <span class="math inline">\(y_i\)</span> as dependent on variables <span class="math inline">\(D_i\)</span> and <span class="math inline">\(T_i\)</span>”</p>
<p>Additionally, wrapping lines withing two $ makes it into a chunk for longer model specifications. Exemplified below by a generaic DiD model.</p>
<p><span class="math display">\[
y_i = \beta_1 D_i + \beta_2 T_i + \beta_3 D_i  T_i + \epsilon_i
\]</span> This code was made within the <code>$$</code> environment, using the following line of text: <code>y_i = \beta_1 D_i + \beta_2 T_i + \beta_3 D_i  T_i + \epsilon_i</code>. This follows generally standard LateX notation rules for mathematical formula.</p>
</section>
</section>
<section id="recommended-packages-and-ecosystems-to-explore" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Recommended packages and ecosystems to explore!</h1>
<p>Packages dedicated to certain subfields of statistical analysis, or other useful programming techniques, will usually have rather extensive user manuals when you google them. These manuals will often have very useful vignettes giving you examples of how to practically use the function, and what type of data it is suited to, so the main task for you is to get the dataframe into an appropriate form for the package. If any of these packages interest you, google them such as “lme4 r package” and read some of the documentation.</p>
<p><code>rstan</code> and its attached packages (see Stan’s homepage) is a useful tool for Bayesian statistical analysis, if that stuff interests you. The <code>brms</code> package implements a very useful hierarchical modelling tool utilizing this Stan, which has certain computational advantages over other packages.</p>
<p>For statistical packages, <code>lme4</code> allows for hierarchical modelling with random effects using Maximum likelihood estimations. <code>plm</code> is a natural extension of glm and lm functions that focus on panel-data estimations. <code>zoo</code>, <code>xts</code> and <code>fts</code> are commonly used for time-series analysis. <code>survreg</code> has survival analysis using maximum likelihood estimations. <code>betareg</code> provides a maximum likelihood implementation for beta regressions (my fav). For causal inference, <code>rdrobust</code> is the most used for regression discontinuity and provides good estimation functions and plotting functions, <code>ivreg</code> for instrumental variable estimation (although both of these methods are rather simple to implement manually in R if you know the math, I have some scripts for it if you are interested). Additionally, the package <code>margineffects</code> (it might actually be <code>margins</code>) is often used in survey experiments to estimate marginal effects, it also has many plot functions for visualizing such effects. <code>HMM</code> provides hidden markov model estimations, extended by <code>mHMMbayes</code> which creates hierarchical HMM’s using Bayesian estimations.</p>
<p>For machine learning procedures, <code>stm</code> is considered a good package to use for structural topic modelling, or LDA estimations. To apply this, one would need to be familiar with text-as-data processing procedures, which are part of the packages <code>tidytext</code>, <code>SnowballC</code>, and <code>quanteda</code>, which might require you to have Python as a backend. For supervised machine learning methods, <code>randomForest</code> provides implementation of the algorithm sometimes known as arbitrary woodland. <code>gbm</code> provides gradient boosting algorithms. For more advanced transformer models however, you will probably need to learn Python.</p>
<p>Text harvesting such as webscraping is an entire entity of itself, maybe I can add a separate document set to this webpage in the future about it. But the relevant packages used for it, and API services are <code>rvest</code> for scraping, <code>httr2</code> for GET and similar HTTP requests, and <code>jsonlite</code> for transforming retrieved JSON files.</p>
<p>Network analysis tools are mostly provided through the <code>igraph</code> package, which is mostly for quantitative analysis of network data. Ego network analysis can be extended from <code>igraph</code> through the <code>egor</code> package. Visualizations of networks however, I feel is simpler using <code>ggraph</code> given that it integrates well with ggplot syntax, so you can utilize familiar methods and functions from that family of packages.</p>
<p>For visualization and reporting of regression outputs, the “industry-standard” so to speak is <code>stargazer</code>. This package provides a single function, named <code>stargazer</code> which has one of the longest help files in existence. But it creates txt, html, or LateX tables for outputs from regressions. It normally only accepts <code>lm</code> and <code>glm</code> functions, but can be extended through certain methods from the <code>broom</code> and <code>broom.mixed</code> packages, which can transform objects that do not have a stargazer method into objects that do, for easier integration. Outside of <code>stargazer</code>, <code>modelsummary</code> provides a flexible solution for table creation, while accepting more types of objects than stargazer. <code>huxreg</code> is also an option when creating quarto documents with regression outputs, it works similar to <code>stargazer</code>. Additionally, ggplot has many functions for visualizing model estimations such as <code>qplot</code>, but many effects estimations visualizations are better created by manually creating dataframes of expected effects with confidence intervals.</p>
<p><code>plotly</code> provides interactive plot elements and animated plot functions for documents meant for websites or similar, there are a lot of interesting elements one can use there, that can be integrated with both quarto documents, or as stand-alone apps in shiny.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>